<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Projeto Final – Aprendendo com Dados e Máquinas</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-05ea6bbbbf92dee331a591801ef1027f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">
      Aprendendo com Dados e Máquinas
      </li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../../">Aprendendo com Dados e Máquinas</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefácio</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Pré-processamento</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/preprocessing/separacao_de_dados_treinamento_validacao_teste.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Separação de Dados para Treino, Verificação e Teste</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/preprocessing/deteccao_e_exclusao_de_dados_duplicados.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Detecção e Exclusão de Dados Duplicados</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/preprocessing/tratamento_de_valores_ausentes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tratamento de Valores Ausentes com Algoritmos de Imputação</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/preprocessing/substituicao_por_medidas_centrais.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Substituição de Outliers por Medidas Centrais</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/preprocessing/numeralizacao_de_variaveis_categoricas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Numeralização de Variáveis Categóricas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/preprocessing/normalizacao_de_dados.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Normalização de Dados Quantitativos</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/preprocessing/geracao_de_atributos_sinteticos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Geração de Atributos Sintéticos</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/preprocessing/verificacao_de_normalidade_dos_dados.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Verificação de Normalidade dos Dados</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/preprocessing/deteccao_de_colinearidade_e_multicolinearidade.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Detecção de Colinearidade e Multicolinearidade</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/preprocessing/selecao_de_atributos_com_metodos_baseados_em_importancia.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Seleção de Atributos com Métodos Baseados em Importância</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/preprocessing/analise_de_componentes_principais_pca.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Análise de Componentes Principais (PCA)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/preprocessing/uso_de_auto_machine_learning_para_preprocessamento.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Uso de Auto Machine Learning para Pré-processamento</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Aprendizado Supervisionado</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/preprocessing/validacao_cruzada_para_modelos_supervisionados.ipynb" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Validação Cruzada para Modelos Supervisionados</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/preprocessing/metricas_para_modelos_de_regressao_e_classificacao.ipynb" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Métricas para Modelos de Regressão e Classificação</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/preprocessing/tecnicas_de_balanceamento_de_classes.ipynb" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Técnicas de Balanceamento de Classes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/preprocessing/treinamento_de_modelos_de_regressao.ipynb" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Treinamento de Modelos de Regressão</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/preprocessing/treinamento_de_modelos_de_classificacao.ipynb" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Treinamento de Modelos de Classificação</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sobre</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Projeto Final</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Professor: Elias Jacob</p>
<p>Aluno: Alexandre Estrela de L. Nobrega</p>
<p>Conjunto de Dados: ToLD-Br</p>
<hr>
<section id="resumo-do-conjunto-de-dados" class="level4">
<h4 class="anchored" data-anchor-id="resumo-do-conjunto-de-dados">Resumo do Conjunto de Dados</h4>
<p>ToLD-Br é o maior conjunto de dados para tweets tóxicos em português brasileiro, desenvolvido a partir de 42 anotadores selecionados a partir de um grupo de 129 voluntários. Os anotadores foram selecionados visando criar um grupo plural em termos de demografia (etnia, orientação sexual, idade, gênero). Cada tweet foi rotulado por três anotadores em 6 categorias possíveis: LGBTQ+fobia, Xenofobia, Obsceno, Insulto, Misoginia e Racismo.</p>
<p>Dado os rótulos, foi possível definir um dataset com texto do tweet (string) seguido por uma classe binária “tóxica” com valores 0 ou 1. O valor de 0 representa um texto não tóxico, e 1 representa um comportamento tóxico.</p>
<hr>
<p><a href="https://github.com/JAugusto97/ToLD-Br/blob/main/experiments/data/1annotator.zip">Baixar dados.</a></p>
<p><a href="https://huggingface.co/datasets/told-br">Fonte dos dados.</a></p>
</section>
<section id="configurando-dados" class="level4">
<h4 class="anchored" data-anchor-id="configurando-dados">Configurando Dados</h4>
<div id="cell-3" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Importando Dados</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'datas/ptbr_train_1annotator.csv'</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#df_test = pd.read_csv('datas/ptbr_test_1annotator.csv')</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#df_validation = pd.read_csv('datas/ptbr_validation_1annotator.csv')</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizando Dados</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">text</th>
<th data-quarto-table-cell-role="th">toxic</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>rt @user olha quem chegouuuuu, nossos queridin...</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>veio umas teorias muito loucas na minha cabeça...</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>@user @user 😂😂😂😂mais nao tinha falado ontem qu...</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>rt @user quer ser filha da puta logo comigo qu...</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>vai besta 😂😂😂😂 casquei com a ultima foto</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="função-de-limpeza-de-dados" class="level4">
<h4 class="anchored" data-anchor-id="função-de-limpeza-de-dados">Função de Limpeza de Dados</h4>
<div id="cell-5" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Funções para limpeza de dados</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> unicodedata</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> accented_characters(text):</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    normalized_text <span class="op">=</span> unicodedata.normalize(<span class="st">'NFKD'</span>, text)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    ascii_text <span class="op">=</span> normalized_text.encode(<span class="st">'ASCII'</span>, <span class="st">'ignore'</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ascii_text.decode()</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> numbers_and_punctuation(text):</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> re.sub(<span class="vs">r'[^a-zA-Z ]'</span>, <span class="st">' '</span>, text)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> text</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> excessive_spaces(text):</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> re.sub(<span class="vs">r'\s+'</span>, <span class="st">' '</span>, text)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> text</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> n_words(text, n):</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> <span class="st">' '</span>.join([word <span class="cf">for</span> word <span class="kw">in</span> text.split() <span class="cf">if</span> <span class="bu">len</span>(word) <span class="op">&gt;</span> n])</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> text</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> all_clear(text, ac <span class="op">=</span> <span class="dv">0</span>, np <span class="op">=</span> <span class="dv">0</span>, es <span class="op">=</span> <span class="dv">0</span>, nw <span class="op">=</span> <span class="dv">0</span>, n <span class="op">=</span> <span class="dv">1</span>):</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ac <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> accented_characters(text)</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> numbers_and_punctuation(text)</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> es <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> excessive_spaces(text)</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> nw <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> n_words(text, n)</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> text</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-6" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicando limpeza de dados</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'text'</span>] <span class="op">=</span> df[<span class="st">'text'</span>].astype(<span class="bu">str</span>).<span class="bu">apply</span>(all_clear, ac<span class="op">=</span><span class="dv">1</span>, np<span class="op">=</span><span class="dv">1</span>, es<span class="op">=</span><span class="dv">1</span>, nw<span class="op">=</span><span class="dv">1</span>, n<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualizando Dados</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">text</th>
<th data-quarto-table-cell-role="th">toxic</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>rt user olha quem chegouuuuu nossos queridinho...</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>veio umas teorias muito loucas na minha cabeca...</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>user user mais nao tinha falado ontem que nao ...</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>rt user quer ser filha da puta logo comigo que...</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>vai besta casquei com ultima foto</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="análise-de-palavras-mais-citadas" class="level4">
<h4 class="anchored" data-anchor-id="análise-de-palavras-mais-citadas">Análise de Palavras mais Citadas</h4>
<p>É sempre bom ter uma noção das palavras que mais aparecem nas frases dos usuários, para assim receber possíveis direcionamentos na criação das funções de rotulagem.</p>
<div id="cell-8" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> TfidfVectorizer</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.corpus <span class="im">import</span> stopwords</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>stopwords_nltk <span class="op">=</span> stopwords.words(<span class="st">'portuguese'</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Carregar as stopwords em português</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>vectorizer <span class="op">=</span> TfidfVectorizer(stop_words<span class="op">=</span>stopwords_nltk, max_features<span class="op">=</span><span class="dv">2000</span>, ngram_range<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">2</span>), min_df<span class="op">=</span><span class="dv">5</span>, max_df<span class="op">=</span><span class="fl">0.8</span>, lowercase<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar um vetor TF-IDF</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>vectorizer.fit(df.text) <span class="co"># Ajuste apenas com os dados de treinamento.</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformar os textos em vetores</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> vectorizer.transform(df.text)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> df.toxic</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_top_ngrams(X_train: np.ndarray, vectorizer: TfidfVectorizer, top_n: <span class="bu">int</span> <span class="op">=</span> <span class="dv">30</span>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co">    Obter os n-grams mais frequentes dos dados textuais vetorizados.</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co">        X_treino (np.ndarray): Os dados textuais vetorizados.</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co">        vectorizer (TfidfVectorizer): O vetor utilizado para transformar os dados textuais.</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co">        top_n (int, optional): O número de top n-grams a retornar. Padrão é 30.</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co">        np.ndarray: Um array dos n-grams mais frequentes.</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Somar todas as colunas para obter a frequência total de cada n-gram</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    total_ngram_frequencies <span class="op">=</span> np.<span class="bu">sum</span>(X_train, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ordenar os n-grams pela sua frequência total</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    sorted_ngrams_indices <span class="op">=</span> np.argsort(total_ngram_frequencies)[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Obter os índices dos top n n-grams mais frequentes</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    top_ngrams_indices <span class="op">=</span> sorted_ngrams_indices[:top_n]</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Obter os nomes dos n-grams correspondentes aos top n índices</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    ngram_names <span class="op">=</span> np.array(vectorizer.get_feature_names_out())</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ngram_names[top_ngrams_indices]</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Usar a função para obter os top 30 n-grams dos dados de treinamento</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>top_ngrams <span class="op">=</span> get_top_ngrams(X_train, vectorizer, top_n<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Palavras mais citadas:</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> words <span class="kw">in</span> top_ngrams:</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, word <span class="kw">in</span> <span class="bu">enumerate</span>(words):</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(word, end<span class="op">=</span><span class="st">', '</span>)</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">%</span> <span class="dv">5</span> <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> i <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>()</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">==</span> <span class="dv">10</span>:</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Palavras mais citadas:

gt gt, honesto, proximidade, voces nao, salles, ano passado, 
aqui nao, primeira impressao, voce vai, correr, pequena, </code></pre>
</div>
</div>
<div id="cell-9" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> wordcloud <span class="im">import</span> WordCloud</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Flatten the list of lists into a single list of words</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>all_words <span class="op">=</span> [word <span class="cf">for</span> words <span class="kw">in</span> top_ngrams <span class="cf">for</span> word <span class="kw">in</span> words]</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Join all words into a single string</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">' '</span>.join(all_words)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the word cloud</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>wordcloud <span class="op">=</span> WordCloud(width<span class="op">=</span><span class="dv">800</span>, height<span class="op">=</span><span class="dv">400</span>, background_color<span class="op">=</span><span class="st">'white'</span>).generate(text)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the word cloud using matplotlib</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>plt.imshow(wordcloud, interpolation<span class="op">=</span><span class="st">'bilinear'</span>)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="separando-dataframe-entre-treino-teste-e-desenvolvimento" class="level4">
<h4 class="anchored" data-anchor-id="separando-dataframe-entre-treino-teste-e-desenvolvimento">Separando DataFrame entre Treino, Teste e Desenvolvimento</h4>
<div id="cell-11" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando backup do DataFrame original:</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>df_label <span class="op">=</span> df.copy()</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> <span class="fl">1.96</span> <span class="co"># Valor Z para nível de confiança de 95%</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="fl">0.5</span> <span class="co"># Proporção esperada de avaliações positivas. Assumimos 50%, que é o pior cenário.</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>e <span class="op">=</span> <span class="fl">0.05</span> <span class="co"># Margem de erro</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculando tamanho da amostra e arredondando</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>tamanho_amostra <span class="op">=</span> math.ceil((z<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> p <span class="op">*</span> (<span class="dv">1</span><span class="op">-</span>p)) <span class="op">/</span> e<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Tamanho da amostra: </span><span class="sc">{</span>tamanho_amostra<span class="sc">}</span><span class="ss">.</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Embaralhando ordem do DataFrame</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>df_label <span class="op">=</span> df_label.sample(frac<span class="op">=</span><span class="fl">1.0</span>, random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando novo DataFrame para treino com primeira metade do DataFrame embaralhado</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> df_label[tamanho_amostra <span class="op">*</span> <span class="dv">2</span>:]</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando DataFrame para treino final com primeira metade do DataFrame embaralhado</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>df_train_final <span class="op">=</span> df_label[tamanho_amostra <span class="op">*</span> <span class="dv">2</span>:]</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Excluindo rótulos do DataFrame de Treino</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> df_train.drop(<span class="st">'toxic'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando novo DataFrame para teste com segunda metade do DataFrame embaralhado</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>df_develop_test <span class="op">=</span> df_label[:tamanho_amostra <span class="op">*</span> <span class="dv">2</span>]</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Dividindo aleatoriamente DataFrames entre teste e desenvolvimento</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>df_test, df_develop <span class="op">=</span> train_test_split(df_develop_test, </span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>                                       test_size<span class="op">=</span><span class="fl">0.5</span>, </span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>                                       random_state<span class="op">=</span><span class="dv">1</span>, </span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>                                       stratify<span class="op">=</span>df_develop_test.toxic)</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Tamanho do conjunto de dados original: </span><span class="sc">{</span><span class="bu">len</span>(df_label)<span class="sc">}</span><span class="ss">."</span>)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Tamanho do conjunto de treinamento: </span><span class="sc">{</span><span class="bu">len</span>(df_train)<span class="sc">}</span><span class="ss">."</span>)</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Tamanho do conjunto de teste: </span><span class="sc">{</span><span class="bu">len</span>(df_test)<span class="sc">}</span><span class="ss">."</span>)</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Tamanho do conjunto de desenvolvimento: </span><span class="sc">{</span><span class="bu">len</span>(df_develop)<span class="sc">}</span><span class="ss">."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Tamanho da amostra: 385.

Tamanho do conjunto de dados original: 16800.
Tamanho do conjunto de treinamento: 16030.
Tamanho do conjunto de teste: 385.
Tamanho do conjunto de desenvolvimento: 385.</code></pre>
</div>
</div>
</section>
<section id="labeling-functions-funções-de-rotulagem-lf-para-palavras" class="level4">
<h4 class="anchored" data-anchor-id="labeling-functions-funções-de-rotulagem-lf-para-palavras">Labeling Functions (Funções de Rotulagem | LF) para Palavras</h4>
<p>As funções de rotulagem de palavras para o presente dataset, servirão para definir com base nas palavras da frase do usuário, se seu comentário foi tóxico ou não.</p>
<ul>
<li><p><strong>( 1 ) Tóxico</strong>: Quando alguma palavra ofensiva e/ou tóxica está presente na frase.</p></li>
<li><p><strong>( 0 ) Não tóxico</strong>: Quando alguma palavra de elogio e/ou gentil está presente na frase.</p></li>
<li><p><strong>( -1 ) Abstenção</strong>: Quando as palavras tóxicas ou não tóxicas não estiverem presentes na frase.</p></li>
</ul>
<div id="cell-13" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> snorkel.labeling <span class="im">import</span> labeling_function</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> snorkel.labeling <span class="im">import</span> PandasLFApplier</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Definindo um dicionário com os padrões regex</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>regex_patterns <span class="op">=</span> {</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"e_amor"</span>: <span class="vs">r'amor'</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"o_boiola"</span>: <span class="vs">r'boiola'</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"e_bom dia"</span>: <span class="vs">r'bom dia'</span>,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"e_boa tarde"</span>: <span class="vs">r'boa tarde'</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"o_buceta"</span>: <span class="vs">r'buceta'</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"o_bunda"</span>: <span class="vs">r'bunda'</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"e_carai"</span>: <span class="vs">r'carai'</span>,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"o_caralho"</span>: <span class="vs">r'caralho'</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"o_cu"</span>: <span class="vs">r'cu'</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"e_feliz"</span>: <span class="vs">r'feliz'</span>,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"o_f[uo]de"</span>: <span class="vs">r'f[uo]de'</span>,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"e_incrivel"</span>: <span class="vs">r'incrivel'</span>,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"e_lind[oa]"</span>: <span class="vs">r'lind[oa]'</span>,</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"e_maravilhos[oa]"</span>: <span class="vs">r'maravilhos[oa]'</span>,</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"o_merd"</span>: <span class="vs">r'merd'</span>,</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"e_mulherao"</span>: <span class="vs">r'mulherao'</span>,</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"o_pal"</span>: <span class="vs">r'pal'</span>,</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"o_pica"</span>: <span class="vs">r'pica'</span>,</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"o_pinto"</span>: <span class="vs">r'pinto'</span>,</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"o_piranha"</span>: <span class="vs">r'piranha'</span>,</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"o_podre"</span>: <span class="vs">r'podre'</span>,</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"o_porra"</span>: <span class="vs">r'porra'</span>,</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"o_pqp"</span>: <span class="vs">r'pqp'</span>,</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"o_put"</span>: <span class="vs">r'put'</span>,</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"o_putinh"</span>: <span class="vs">r'putinh'</span>,</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"o_ridicul"</span>: <span class="vs">r'ridicul'</span>,</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">"o_sapatao"</span>: <span class="vs">r'sapatao'</span>,</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"o_tnc"</span>: <span class="vs">r'tnc'</span>,</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">"o_vaca"</span>: <span class="vs">r'vaca'</span>,</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"o_vagabund"</span>: <span class="vs">r'vagabund'</span>,</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">"o_viado"</span>: <span class="vs">r'viado'</span>,</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"e_vsf"</span>: <span class="vs">r'vsf'</span>,</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"o_vtnc"</span>: <span class="vs">r'vtnc'</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Função que define funções que definem as Labeling Funcions</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_labeling_function(index, pattern, label_positive, label_negative):</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>    regex <span class="op">=</span> re.<span class="bu">compile</span>(pattern, re.IGNORECASE)</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">@labeling_function</span>(name<span class="op">=</span><span class="ss">f'lf_r_</span><span class="sc">{</span>index<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> lf(x):</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> label_positive <span class="cf">if</span> regex.search(x.text) <span class="cf">else</span> label_negative</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lf</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Definindo Funções de Labeling Functions</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>lfs <span class="op">=</span> []</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, item <span class="kw">in</span> regex_patterns.items():</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i[<span class="dv">0</span>] <span class="op">==</span> <span class="st">'o'</span>:</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>        lfs.append(create_labeling_function(i, item, <span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>))</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>        lfs.append(create_labeling_function(i, item, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>))</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>applier <span class="op">=</span> PandasLFApplier(lfs<span class="op">=</span>lfs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nota-se que a esmagadora maioria das das palavras definidas nas LF’s não estão presentes no gráfico da nuvem de palavras. Porém é importante ter em mente que a escolha das palavras que irão compor elas não está unicamente associada a quantidade de vezes que elas aparecem nos textos, pois também é relevante escolher palavras com alto grau de certeza de que caso elas componham a frase, será obtido um rótulo correto.</p>
<section id="analisando-influência-das-funções-de-rotulagem" class="level5">
<h5 class="anchored" data-anchor-id="analisando-influência-das-funções-de-rotulagem">Analisando Influência das Funções de Rotulagem</h5>
<ol type="1">
<li><p><strong>j</strong>: Índice da função de rotulagem</p></li>
<li><p><strong>Polarity</strong>: Se a LF se refere a tóxidade e/ou não tóxidade.</p></li>
<li><p><strong>Coverage</strong>: Proporção de vezes que uma função de rotulagem forneceu rotulos para instâncias (amostras de dados).</p></li>
<li><p><strong>Overlaps</strong>: Proporção de vezes que uma função de rotulagem forneceu rótulos para instâncias que foram rotuladas por pelo menos outra função de rotulagem de mesma polaridade.</p></li>
<li><p><strong>Conflicts</strong>: Proporção de vezes que uma função de rotulagem atribuiu rótulos de polaridade diferente dos rótulos atribuídos por outras funções de rotulagem para as mesmas instâncias.</p></li>
</ol>
<div id="cell-16" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> snorkel.labeling <span class="im">import</span> LFAnalysis</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplica as funções de rotulagem (lfs) no conjunto de dados de treinamento (df_label_train_tain)</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># L_train é uma matriz onde cada linha representa um exemplo e cada coluna representa a saída de uma função de rotulagem</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>L_train <span class="op">=</span> applier.<span class="bu">apply</span>(df<span class="op">=</span>df_train)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\n</span><span class="ss">Total Coverge: </span><span class="sc">{</span>LFAnalysis(L<span class="op">=</span>L_train, lfs<span class="op">=</span>lfs)<span class="sc">.</span>label_coverage()<span class="sc">}</span><span class="ss">.'</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Cria uma instância de LFAnalysis para analisar o desempenho das funções de rotulagem</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>LFAnalysis(L<span class="op">=</span>L_train, lfs<span class="op">=</span>lfs).lf_summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 16030/16030 [00:04&lt;00:00, 3826.20it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Total Coverge: 0.536930754834685.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">j</th>
<th data-quarto-table-cell-role="th">Polarity</th>
<th data-quarto-table-cell-role="th">Coverage</th>
<th data-quarto-table-cell-role="th">Overlaps</th>
<th data-quarto-table-cell-role="th">Conflicts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_e_amor</td>
<td>0</td>
<td>[0]</td>
<td>0.022021</td>
<td>0.012227</td>
<td>0.010792</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_boiola</td>
<td>1</td>
<td>[1]</td>
<td>0.001934</td>
<td>0.000374</td>
<td>0.000250</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_e_bom dia</td>
<td>2</td>
<td>[0]</td>
<td>0.002246</td>
<td>0.001310</td>
<td>0.001061</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_boa tarde</td>
<td>3</td>
<td>[0]</td>
<td>0.000873</td>
<td>0.000437</td>
<td>0.000250</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_buceta</td>
<td>4</td>
<td>[1]</td>
<td>0.003493</td>
<td>0.001622</td>
<td>0.000187</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_bunda</td>
<td>5</td>
<td>[1]</td>
<td>0.004616</td>
<td>0.003431</td>
<td>0.000686</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_e_carai</td>
<td>6</td>
<td>[0]</td>
<td>0.016594</td>
<td>0.003369</td>
<td>0.002870</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_caralho</td>
<td>7</td>
<td>[1]</td>
<td>0.079538</td>
<td>0.025639</td>
<td>0.007548</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_cu</td>
<td>8</td>
<td>[1]</td>
<td>0.117467</td>
<td>0.042296</td>
<td>0.009108</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_feliz</td>
<td>9</td>
<td>[0]</td>
<td>0.012976</td>
<td>0.005864</td>
<td>0.005053</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_f[uo]de</td>
<td>10</td>
<td>[1]</td>
<td>0.022208</td>
<td>0.009482</td>
<td>0.002059</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_incrivel</td>
<td>11</td>
<td>[0]</td>
<td>0.003556</td>
<td>0.001809</td>
<td>0.001310</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_e_lind[oa]</td>
<td>12</td>
<td>[0]</td>
<td>0.021460</td>
<td>0.012601</td>
<td>0.010917</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_maravilhos[oa]</td>
<td>13</td>
<td>[0]</td>
<td>0.003431</td>
<td>0.001934</td>
<td>0.001560</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_merd</td>
<td>14</td>
<td>[1]</td>
<td>0.025203</td>
<td>0.019588</td>
<td>0.002371</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_mulherao</td>
<td>15</td>
<td>[0]</td>
<td>0.000936</td>
<td>0.000936</td>
<td>0.000873</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_pal</td>
<td>16</td>
<td>[1]</td>
<td>0.015721</td>
<td>0.007361</td>
<td>0.001372</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_pica</td>
<td>17</td>
<td>[1]</td>
<td>0.004492</td>
<td>0.001123</td>
<td>0.000312</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_pinto</td>
<td>18</td>
<td>[1]</td>
<td>0.002932</td>
<td>0.000437</td>
<td>0.000062</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_piranha</td>
<td>19</td>
<td>[1]</td>
<td>0.004492</td>
<td>0.001372</td>
<td>0.000374</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_podre</td>
<td>20</td>
<td>[1]</td>
<td>0.001061</td>
<td>0.000561</td>
<td>0.000125</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_porra</td>
<td>21</td>
<td>[1]</td>
<td>0.093637</td>
<td>0.025390</td>
<td>0.007611</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_pqp</td>
<td>22</td>
<td>[1]</td>
<td>0.080599</td>
<td>0.016032</td>
<td>0.005864</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_put</td>
<td>23</td>
<td>[1]</td>
<td>0.075483</td>
<td>0.028759</td>
<td>0.004991</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_putinh</td>
<td>24</td>
<td>[1]</td>
<td>0.003119</td>
<td>0.003119</td>
<td>0.000062</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_ridicul</td>
<td>25</td>
<td>[1]</td>
<td>0.008921</td>
<td>0.008921</td>
<td>0.000312</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_sapatao</td>
<td>26</td>
<td>[1]</td>
<td>0.003369</td>
<td>0.000873</td>
<td>0.000312</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_tnc</td>
<td>27</td>
<td>[1]</td>
<td>0.010044</td>
<td>0.005614</td>
<td>0.000499</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_vaca</td>
<td>28</td>
<td>[1]</td>
<td>0.003182</td>
<td>0.000499</td>
<td>0.000125</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_vagabund</td>
<td>29</td>
<td>[1]</td>
<td>0.007735</td>
<td>0.003493</td>
<td>0.000561</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_viado</td>
<td>30</td>
<td>[1]</td>
<td>0.006925</td>
<td>0.001684</td>
<td>0.000499</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_vsf</td>
<td>31</td>
<td>[0]</td>
<td>0.012165</td>
<td>0.003930</td>
<td>0.003119</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_vtnc</td>
<td>32</td>
<td>[1]</td>
<td>0.004616</td>
<td>0.004616</td>
<td>0.000374</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>A tabela mostra que as LF’s conseguiram cobrir aproximadamente 54% de todo o dataset, com algumas palavras que estiveram presentes na nuvem de palavras (porra e cu) ganhando destaque por seu alto <em>Coverage</em>, e baixo <em>Conflict</em>.</p>
</section>
<section id="analisando-o-acerto-das-funções-de-rotulagem" class="level5">
<h5 class="anchored" data-anchor-id="analisando-o-acerto-das-funções-de-rotulagem">Analisando o Acerto das Funções de Rotulagem</h5>
<div id="cell-19" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplica as funções de rotulagem (lfs) no conjunto de dados de desenvolvimento (df_label_train_develop)</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># L_dev é uma matriz onde cada linha representa um exemplo e cada coluna representa a saída de uma função de rotulagem</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>L_dev <span class="op">=</span> applier.<span class="bu">apply</span>(df<span class="op">=</span>df_develop)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Cria uma instância de LFAnalysis para analisar o desempenho das funções de rotulagem, com acertos e erros</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>LFAnalysis(L<span class="op">=</span>L_dev, lfs<span class="op">=</span>lfs).lf_summary(Y<span class="op">=</span>df_develop.toxic.values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 385/385 [00:00&lt;00:00, 3457.98it/s]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">j</th>
<th data-quarto-table-cell-role="th">Polarity</th>
<th data-quarto-table-cell-role="th">Coverage</th>
<th data-quarto-table-cell-role="th">Overlaps</th>
<th data-quarto-table-cell-role="th">Conflicts</th>
<th data-quarto-table-cell-role="th">Correct</th>
<th data-quarto-table-cell-role="th">Incorrect</th>
<th data-quarto-table-cell-role="th">Emp. Acc.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_e_amor</td>
<td>0</td>
<td>[0]</td>
<td>0.031169</td>
<td>0.018182</td>
<td>0.018182</td>
<td>9</td>
<td>3</td>
<td>0.750000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_boiola</td>
<td>1</td>
<td>[1]</td>
<td>0.002597</td>
<td>0.002597</td>
<td>0.000000</td>
<td>1</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_e_bom dia</td>
<td>2</td>
<td>[0]</td>
<td>0.005195</td>
<td>0.002597</td>
<td>0.002597</td>
<td>2</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_boa tarde</td>
<td>3</td>
<td>[0]</td>
<td>0.005195</td>
<td>0.005195</td>
<td>0.002597</td>
<td>1</td>
<td>1</td>
<td>0.500000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_buceta</td>
<td>4</td>
<td>[1]</td>
<td>0.010390</td>
<td>0.002597</td>
<td>0.000000</td>
<td>4</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_bunda</td>
<td>5</td>
<td>[1]</td>
<td>0.007792</td>
<td>0.005195</td>
<td>0.000000</td>
<td>3</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_e_carai</td>
<td>6</td>
<td>[0]</td>
<td>0.010390</td>
<td>0.002597</td>
<td>0.002597</td>
<td>3</td>
<td>1</td>
<td>0.750000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_caralho</td>
<td>7</td>
<td>[1]</td>
<td>0.103896</td>
<td>0.031169</td>
<td>0.005195</td>
<td>27</td>
<td>13</td>
<td>0.675000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_cu</td>
<td>8</td>
<td>[1]</td>
<td>0.083117</td>
<td>0.025974</td>
<td>0.005195</td>
<td>21</td>
<td>11</td>
<td>0.656250</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_feliz</td>
<td>9</td>
<td>[0]</td>
<td>0.018182</td>
<td>0.007792</td>
<td>0.005195</td>
<td>5</td>
<td>2</td>
<td>0.714286</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_f[uo]de</td>
<td>10</td>
<td>[1]</td>
<td>0.033766</td>
<td>0.012987</td>
<td>0.002597</td>
<td>10</td>
<td>3</td>
<td>0.769231</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_incrivel</td>
<td>11</td>
<td>[0]</td>
<td>0.005195</td>
<td>0.002597</td>
<td>0.002597</td>
<td>1</td>
<td>1</td>
<td>0.500000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_e_lind[oa]</td>
<td>12</td>
<td>[0]</td>
<td>0.018182</td>
<td>0.005195</td>
<td>0.005195</td>
<td>4</td>
<td>3</td>
<td>0.571429</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_maravilhos[oa]</td>
<td>13</td>
<td>[0]</td>
<td>0.005195</td>
<td>0.000000</td>
<td>0.000000</td>
<td>2</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_merd</td>
<td>14</td>
<td>[1]</td>
<td>0.023377</td>
<td>0.018182</td>
<td>0.005195</td>
<td>8</td>
<td>1</td>
<td>0.888889</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_mulherao</td>
<td>15</td>
<td>[0]</td>
<td>0.002597</td>
<td>0.002597</td>
<td>0.002597</td>
<td>1</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_pal</td>
<td>16</td>
<td>[1]</td>
<td>0.010390</td>
<td>0.010390</td>
<td>0.005195</td>
<td>3</td>
<td>1</td>
<td>0.750000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_pica</td>
<td>17</td>
<td>[1]</td>
<td>0.002597</td>
<td>0.000000</td>
<td>0.000000</td>
<td>1</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_pinto</td>
<td>18</td>
<td>[1]</td>
<td>0.007792</td>
<td>0.000000</td>
<td>0.000000</td>
<td>2</td>
<td>1</td>
<td>0.666667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_piranha</td>
<td>19</td>
<td>[1]</td>
<td>0.002597</td>
<td>0.000000</td>
<td>0.000000</td>
<td>1</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_podre</td>
<td>20</td>
<td>[1]</td>
<td>0.002597</td>
<td>0.002597</td>
<td>0.000000</td>
<td>1</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_porra</td>
<td>21</td>
<td>[1]</td>
<td>0.106494</td>
<td>0.044156</td>
<td>0.015584</td>
<td>29</td>
<td>12</td>
<td>0.707317</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_pqp</td>
<td>22</td>
<td>[1]</td>
<td>0.090909</td>
<td>0.015584</td>
<td>0.007792</td>
<td>21</td>
<td>14</td>
<td>0.600000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_put</td>
<td>23</td>
<td>[1]</td>
<td>0.088312</td>
<td>0.041558</td>
<td>0.005195</td>
<td>25</td>
<td>9</td>
<td>0.735294</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_putinh</td>
<td>24</td>
<td>[1]</td>
<td>0.007792</td>
<td>0.007792</td>
<td>0.000000</td>
<td>3</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_ridicul</td>
<td>25</td>
<td>[1]</td>
<td>0.005195</td>
<td>0.005195</td>
<td>0.000000</td>
<td>2</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_sapatao</td>
<td>26</td>
<td>[1]</td>
<td>0.002597</td>
<td>0.002597</td>
<td>0.000000</td>
<td>1</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_tnc</td>
<td>27</td>
<td>[1]</td>
<td>0.015584</td>
<td>0.007792</td>
<td>0.000000</td>
<td>4</td>
<td>2</td>
<td>0.666667</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_vaca</td>
<td>28</td>
<td>[1]</td>
<td>0.002597</td>
<td>0.000000</td>
<td>0.000000</td>
<td>1</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_vagabund</td>
<td>29</td>
<td>[1]</td>
<td>0.005195</td>
<td>0.005195</td>
<td>0.000000</td>
<td>2</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_viado</td>
<td>30</td>
<td>[1]</td>
<td>0.005195</td>
<td>0.000000</td>
<td>0.000000</td>
<td>2</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_vsf</td>
<td>31</td>
<td>[0]</td>
<td>0.007792</td>
<td>0.002597</td>
<td>0.002597</td>
<td>2</td>
<td>1</td>
<td>0.666667</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_vtnc</td>
<td>32</td>
<td>[1]</td>
<td>0.005195</td>
<td>0.005195</td>
<td>0.000000</td>
<td>2</td>
<td>0</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Como pode ser visto na tabela, todas as funções de rotulagem obtiveram um grau de acertabilidade, ao comparar com os rótulos originais, igual ou maior que 50% (com a esmagadora maioria sendo maior).</p>
</section>
<section id="analisando-conflito-entre-funções-de-rotulagem" class="level5">
<h5 class="anchored" data-anchor-id="analisando-conflito-entre-funções-de-rotulagem">Analisando Conflito entre Funções de Rotulagem</h5>
<div id="cell-22" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_conflict_matrices(L_train, lfs):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Função para criar e processar a matriz de conflitos normalizada</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_conflict_matrix(L, lfs, normalize<span class="op">=</span><span class="va">False</span>, column_name<span class="op">=</span><span class="st">'conflict'</span>):</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>        lf_analysis <span class="op">=</span> LFAnalysis(L<span class="op">=</span>L, lfs<span class="op">=</span>lfs)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>        conflict_matrix <span class="op">=</span> lf_analysis.lf_conflicts(normalize_by_overlaps<span class="op">=</span>normalize)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>        conflict_matrix <span class="op">=</span> pd.DataFrame([conflict_matrix], columns<span class="op">=</span>[lf.name <span class="cf">for</span> lf <span class="kw">in</span> lfs]).T</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>        conflict_matrix.columns <span class="op">=</span> [column_name]</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>        conflict_matrix <span class="op">=</span> conflict_matrix.sort_values(by<span class="op">=</span>column_name, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> conflict_matrix</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcular a matriz de conflitos normalizada</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    normalized_conflict_matrix <span class="op">=</span> process_conflict_matrix(L_train, lfs, normalize<span class="op">=</span><span class="va">True</span>, column_name<span class="op">=</span><span class="st">'normalized_conflict'</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcular a matriz de conflitos não normalizada</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    conflict_matrix <span class="op">=</span> process_conflict_matrix(L_train, lfs, normalize<span class="op">=</span><span class="va">False</span>, column_name<span class="op">=</span><span class="st">'conflict'</span>)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Concatenar as duas matrizes de conflitos</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    final_cm <span class="op">=</span> pd.concat([conflict_matrix, normalized_conflict_matrix], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> final_cm</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular a matriz de conflitos final</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>compute_conflict_matrices(L_train, lfs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">conflict</th>
<th data-quarto-table-cell-role="th">normalized_conflict</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_e_lind[oa]</td>
<td>0.010917</td>
<td>0.866337</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_amor</td>
<td>0.010792</td>
<td>0.882653</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_cu</td>
<td>0.009108</td>
<td>0.215339</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_porra</td>
<td>0.007611</td>
<td>0.299754</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_caralho</td>
<td>0.007548</td>
<td>0.294404</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_pqp</td>
<td>0.005864</td>
<td>0.365759</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_e_feliz</td>
<td>0.005053</td>
<td>0.861702</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_put</td>
<td>0.004991</td>
<td>0.173536</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_e_vsf</td>
<td>0.003119</td>
<td>0.793651</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_carai</td>
<td>0.002870</td>
<td>0.851852</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_merd</td>
<td>0.002371</td>
<td>0.121019</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_f[uo]de</td>
<td>0.002059</td>
<td>0.217105</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_e_maravilhos[oa]</td>
<td>0.001560</td>
<td>0.806452</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_pal</td>
<td>0.001372</td>
<td>0.186441</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_e_incrivel</td>
<td>0.001310</td>
<td>0.724138</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_bom dia</td>
<td>0.001061</td>
<td>0.809524</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_e_mulherao</td>
<td>0.000873</td>
<td>0.933333</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_bunda</td>
<td>0.000686</td>
<td>0.200000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_vagabund</td>
<td>0.000561</td>
<td>0.160714</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_viado</td>
<td>0.000499</td>
<td>0.296296</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_tnc</td>
<td>0.000499</td>
<td>0.088889</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_vtnc</td>
<td>0.000374</td>
<td>0.081081</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_piranha</td>
<td>0.000374</td>
<td>0.272727</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_ridicul</td>
<td>0.000312</td>
<td>0.034965</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_sapatao</td>
<td>0.000312</td>
<td>0.357143</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_pica</td>
<td>0.000312</td>
<td>0.277778</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_boiola</td>
<td>0.000250</td>
<td>0.666667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_boa tarde</td>
<td>0.000250</td>
<td>0.571429</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_buceta</td>
<td>0.000187</td>
<td>0.115385</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_podre</td>
<td>0.000125</td>
<td>0.222222</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_vaca</td>
<td>0.000125</td>
<td>0.250000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_putinh</td>
<td>0.000062</td>
<td>0.020000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_pinto</td>
<td>0.000062</td>
<td>0.142857</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-23" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> conflict_matrix(lfs, L):</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Esta função calcula a matriz de conflitos para um conjunto de funções de rotulagem e um conjunto de dados rotulados.</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co">    - lfs: Uma lista de funções de rotulagem.</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">    - L: Um array numpy de forma (num_examples, num_lfs) contendo os rótulos atribuídos por cada função de rotulagem a cada exemplo.</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co">    Retorna:</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co">    - Um DataFrame do pandas contendo a matriz de conflitos.</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Inicializa uma matriz de zeros com forma (num_lfs, num_lfs)</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    conflict_matrix <span class="op">=</span> np.zeros((<span class="bu">len</span>(lfs), <span class="bu">len</span>(lfs)))</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcula o conflito entre cada par de funções de rotulagem</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(lfs)):</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(lfs)):</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Calcula o conflito entre as funções de rotulagem i e j</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>            conflict_matrix[i, j] <span class="op">=</span> ((L[:, i] <span class="op">!=</span> L[:, j]) <span class="op">&amp;</span> (L[:, i] <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span>) <span class="op">&amp;</span> (L[:, j] <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span>)).mean()</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Converte a matriz de conflitos para um DataFrame do pandas com os nomes das funções de rotulagem como rótulos das linhas e colunas</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    conflict_matrix <span class="op">=</span> pd.DataFrame(conflict_matrix, columns<span class="op">=</span>[lf.name <span class="cf">for</span> lf <span class="kw">in</span> lfs], index<span class="op">=</span>[lf.name <span class="cf">for</span> lf <span class="kw">in</span> lfs])</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> conflict_matrix</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> matrix_graph(lfs, L_train):</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plotar a matriz de conflitos usando seaborn</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">4</span>))</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(conflict_matrix(lfs, L_train), annot<span class="op">=</span><span class="va">False</span>, cmap<span class="op">=</span><span class="st">"coolwarm"</span>, cbar<span class="op">=</span><span class="va">True</span>, annot_kws<span class="op">=</span>{<span class="st">"fontsize"</span>: <span class="dv">6</span>})</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Matriz de Conflitos entre Funções de Rotulagem</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, fontsize<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>    plt.yticks(rotation<span class="op">=</span><span class="dv">45</span>, fontsize<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>matrix_graph(lfs, L_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>O gráfico da matriz de conflito demonstra que de forma geral é bem baixo o índice de conflitos, com apenas alguns pontos apresentando uma maior diferença do padrão.</p>
</section>
</section>
<section id="labeling-functions-para-palavras-com-uso-de-transformer" class="level4">
<h4 class="anchored" data-anchor-id="labeling-functions-para-palavras-com-uso-de-transformer">Labeling Functions para Palavras com uso de Transformer</h4>
<p>O uso de um transformer como LF, será a aplicação de um modelo pré-treinado (a partir de um dataset com características semelhantes) para a rotulação das instâncias. O autor do transformer utilizado no presente carderno o define como um classificador de sequência de modelo multilíngue Distil-Bert treinado com base no conjunto de dados JIGSAW Toxic Comment Classification Challenge.</p>
<hr>
<p>O autor do transformer explica que o modelo foi treinado em um subconjunto aleatório do conjunto de dados told-br (1/3 do tamanho original). Ele deixa claro que o principal objetivo é fornecer um pequeno modelo que possa ser usado para classificar tweets em português brasileiro de forma binária (‘tóxico’ ou ‘não tóxico’).</p>
<p>O conjunto de dados que o transformer utilizou curiosamente foi o mesmo que está sendo usado no presente estudo. Será interessante ver como ele desempenhará apenas compondo parte das funções de rotulagem.</p>
<hr>
<p><a href="https://huggingface.co/inctdd/told_br_binary_sm">Fonte do modelo do Transformer.</a></p>
<div id="cell-26" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> AutoTokenizer, AutoModelForSequenceClassification, pipeline</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define o caminho do modelo (um caminho local ou um identificador de modelo de huggingface.co/models)</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>model_path <span class="op">=</span> <span class="st">"inctdd/told_br_binary_sm"</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Carrega o tokenizador e o modelo</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>tokenizer_hf <span class="op">=</span> AutoTokenizer.from_pretrained(model_path)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>model_hf <span class="op">=</span> AutoModelForSequenceClassification.from_pretrained(model_path)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Cria um classificador de sentimento que une o tokenizador e o modelo como um pipeline</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>toxic_classifier <span class="op">=</span> pipeline(<span class="st">"text-classification"</span>, model<span class="op">=</span>model_hf, tokenizer<span class="op">=</span>tokenizer_hf, device<span class="op">=</span><span class="dv">1</span> <span class="cf">if</span> torch.cuda.is_available() <span class="cf">else</span> <span class="op">-</span><span class="dv">1</span>, verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Imprime o dispositivo em que o modelo está. Cuda significa GPU, caso contrário, CPU. GPU é mais rápido.</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'- Modelo em que o dispositivo está: </span><span class="sc">{</span>model_hf<span class="sc">.</span>device<span class="sc">}</span><span class="ss">.</span><span class="ch">\n</span><span class="ss">'</span>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> df_train.sample(<span class="dv">10</span>, random_state<span class="op">=</span><span class="dv">1</span>).itertuples():</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Text: </span><span class="sc">{</span>row<span class="sc">.</span>text<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Label: </span><span class="sc">{</span>toxic_classifier(row.text)[<span class="dv">0</span>][<span class="st">'label'</span>]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Score: </span><span class="sc">{</span>toxic_classifier(row.text)[<span class="dv">0</span>][<span class="st">'score'</span>]<span class="sc">}</span><span class="ch">\n</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>- Modelo em que o dispositivo está: cpu.

Text: estou juntando dinheiro no cofre focoooo vou encher essa porra toda
Label: 0
Score: 0.630939781665802

Text: user Depois de encher rabo com dinheiro da lei Rouanet se aproveitar do dinheiro dos pagadores de imposto tem cara de pau de vir publico defender militantes disfarcados de jornalistas cujo unico objetivo soltar Jumento de nove dedos
Label: 1
Score: 0.9713601469993591

Text: user de cair cu da bunda
Label: 1
Score: 0.9717990159988403

Text: user bah entao tu imagina com vou ficar quase tao linda quanto tu
Label: 0
Score: 0.9809370636940002

Text: montando meu primeiro curriculo para estagio la no hospital so consigo pensar beleza nome ja foi agora que que eu escrevo
Label: 0
Score: 0.9876489043235779

Text: boa tarde so pra quem ta com fome de cu
Label: 1
Score: 0.9587632417678833

Text: to ligada no pqp
Label: 1
Score: 0.5966371893882751

Text: hoje eu acordei com uma vontade de morrer me olhei no espelho nao aguentei nao suporto nem me ver eu sou assim um lixo burro fracassado acho que eu vou me matar
Label: 1
Score: 0.8548468351364136

Text: rt user me matem de uma vez porraaaaa ahhahaha eu toda quando vi foto kkkkk https co mwl ssaw
Label: 0
Score: 0.633847713470459

Text: user que tem ver um com os outros
Label: 0
Score: 0.974162757396698
</code></pre>
</div>
</div>
<p>Criando Labeling Function para Transformer</p>
<div id="cell-28" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> snorkel.preprocess <span class="im">import</span> preprocessor</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define um pré-processador usando a função de decorador do Snorkel</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="at">@preprocessor</span>(memoize<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hf_toxic(x):</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Esta função é um pré-processador que usa um classificador de toxidade pré-treinado para adicionar</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co">    uma etiqueta de previsão e um score aos dados de entrada.</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co">    - x: Um objeto contendo os dados de entrada, que deve ter um atributo 'text' contendo o texto a ser classificado.</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Retorna:</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co">    - O mesmo objeto de entrada 'x', mas com atributos adicionais 'pred_label' e 'score' adicionados com base nas previsões do modelo.</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define argumentos para o tokenizador, garantindo que o texto seja preenchido e truncado para um comprimento máximo de 512 tokens</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    tokenizer_kwargs <span class="op">=</span> {<span class="st">'padding'</span>: <span class="va">True</span>, <span class="st">'truncation'</span>: <span class="va">True</span>, <span class="st">'max_length'</span>: <span class="dv">512</span>}</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Obtém as pontuações de sentimento do classificador de sentimento pré-treinado</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># O [0] no final é usado para obter o primeiro (e único) resultado do classificador, pois a saída é uma lista de previsões</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> toxic_classifier(x.text, <span class="op">**</span>tokenizer_kwargs)[<span class="dv">0</span>]</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adiciona a etiqueta prevista ('label') e a pontuação ('score') aos atributos do objeto 'x'</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>    x.pred_label <span class="op">=</span> scores.get(<span class="st">'label'</span>)</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>    x.score <span class="op">=</span> scores.get(<span class="st">'score'</span>)</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Retorna o objeto 'x' modificado</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a><span class="at">@labeling_function</span>(pre<span class="op">=</span>[hf_toxic])</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> lf_hf_toxic(x):</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a><span class="co">    Esta função de rotulagem atribui um rótulo baseado no sentimento previsto por um classificador de sentimento pré-treinado.</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a><span class="co">    - x: Um objeto de entrada que deve ter atributos 'pred_label' e 'score' adicionados pelo pré-processador 'hf_toxic'.</span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a><span class="co">    Retorna:</span></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a><span class="co">    - ( 1) se a pontuação do sentimento for maior ou igual a 0.85 e o rótulo previsto por 'toxic'.</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a><span class="co">    - ( 0) se a pontuação do sentimento for maior ou igual a 0.85 e o rótulo previsto for 'not_toxic'.</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a><span class="co">    - (-1) caso contrário.</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Verifica se a pontuação do sentimento é maior ou igual a 0.85</span></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x.score <span class="op">&gt;=</span> <span class="fl">0.85</span>:</span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Se o rótulo previsto for 'Positive', retorna YES</span></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> x.pred_label <span class="op">==</span> <span class="st">'1'</span>:</span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Se o rótulo previsto for 'Negative', retorna NO</span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> x.pred_label <span class="op">==</span> <span class="st">'0'</span>:</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Retorna ABSTAIN se a pontuação for menor que 0.85 ou o rótulo não for 'toxic' nem 'not_toxic'</span></span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>lfs.append(lf_hf_toxic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Aplicando as Funções de Rotulagem antigas com a nova do Transformer</p>
<div id="cell-30" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>applier <span class="op">=</span> PandasLFApplier(lfs<span class="op">=</span>lfs)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>L_train <span class="op">=</span> applier.<span class="bu">apply</span>(df<span class="op">=</span>df_train)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>L_dev <span class="op">=</span> applier.<span class="bu">apply</span>(df<span class="op">=</span>df_develop)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\n</span><span class="ss">Total Coverge: </span><span class="sc">{</span>LFAnalysis(L<span class="op">=</span>L_dev, lfs<span class="op">=</span>lfs)<span class="sc">.</span>label_coverage()<span class="sc">}</span><span class="ss">.'</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>LFAnalysis(L<span class="op">=</span>L_dev, lfs<span class="op">=</span>lfs).lf_summary(Y<span class="op">=</span>df_develop.toxic.values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 16030/16030 [31:06&lt;00:00,  8.59it/s] 
100%|██████████| 385/385 [00:42&lt;00:00,  9.01it/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Total Coverge: 0.8649350649350649.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">j</th>
<th data-quarto-table-cell-role="th">Polarity</th>
<th data-quarto-table-cell-role="th">Coverage</th>
<th data-quarto-table-cell-role="th">Overlaps</th>
<th data-quarto-table-cell-role="th">Conflicts</th>
<th data-quarto-table-cell-role="th">Correct</th>
<th data-quarto-table-cell-role="th">Incorrect</th>
<th data-quarto-table-cell-role="th">Emp. Acc.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_e_amor</td>
<td>0</td>
<td>[0]</td>
<td>0.031169</td>
<td>0.031169</td>
<td>0.018182</td>
<td>9</td>
<td>3</td>
<td>0.750000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_boiola</td>
<td>1</td>
<td>[1]</td>
<td>0.002597</td>
<td>0.002597</td>
<td>0.000000</td>
<td>1</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_e_bom dia</td>
<td>2</td>
<td>[0]</td>
<td>0.005195</td>
<td>0.005195</td>
<td>0.002597</td>
<td>2</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_boa tarde</td>
<td>3</td>
<td>[0]</td>
<td>0.005195</td>
<td>0.005195</td>
<td>0.002597</td>
<td>1</td>
<td>1</td>
<td>0.500000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_buceta</td>
<td>4</td>
<td>[1]</td>
<td>0.010390</td>
<td>0.010390</td>
<td>0.000000</td>
<td>4</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_bunda</td>
<td>5</td>
<td>[1]</td>
<td>0.007792</td>
<td>0.007792</td>
<td>0.000000</td>
<td>3</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_e_carai</td>
<td>6</td>
<td>[0]</td>
<td>0.010390</td>
<td>0.002597</td>
<td>0.002597</td>
<td>3</td>
<td>1</td>
<td>0.750000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_caralho</td>
<td>7</td>
<td>[1]</td>
<td>0.103896</td>
<td>0.044156</td>
<td>0.010390</td>
<td>27</td>
<td>13</td>
<td>0.675000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_cu</td>
<td>8</td>
<td>[1]</td>
<td>0.083117</td>
<td>0.072727</td>
<td>0.028571</td>
<td>21</td>
<td>11</td>
<td>0.656250</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_feliz</td>
<td>9</td>
<td>[0]</td>
<td>0.018182</td>
<td>0.018182</td>
<td>0.005195</td>
<td>5</td>
<td>2</td>
<td>0.714286</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_f[uo]de</td>
<td>10</td>
<td>[1]</td>
<td>0.033766</td>
<td>0.028571</td>
<td>0.002597</td>
<td>10</td>
<td>3</td>
<td>0.769231</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_incrivel</td>
<td>11</td>
<td>[0]</td>
<td>0.005195</td>
<td>0.002597</td>
<td>0.002597</td>
<td>1</td>
<td>1</td>
<td>0.500000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_e_lind[oa]</td>
<td>12</td>
<td>[0]</td>
<td>0.018182</td>
<td>0.018182</td>
<td>0.007792</td>
<td>4</td>
<td>3</td>
<td>0.571429</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_maravilhos[oa]</td>
<td>13</td>
<td>[0]</td>
<td>0.005195</td>
<td>0.005195</td>
<td>0.000000</td>
<td>2</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_merd</td>
<td>14</td>
<td>[1]</td>
<td>0.023377</td>
<td>0.020779</td>
<td>0.005195</td>
<td>8</td>
<td>1</td>
<td>0.888889</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_mulherao</td>
<td>15</td>
<td>[0]</td>
<td>0.002597</td>
<td>0.002597</td>
<td>0.002597</td>
<td>1</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_pal</td>
<td>16</td>
<td>[1]</td>
<td>0.010390</td>
<td>0.010390</td>
<td>0.005195</td>
<td>3</td>
<td>1</td>
<td>0.750000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_pica</td>
<td>17</td>
<td>[1]</td>
<td>0.002597</td>
<td>0.000000</td>
<td>0.000000</td>
<td>1</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_pinto</td>
<td>18</td>
<td>[1]</td>
<td>0.007792</td>
<td>0.007792</td>
<td>0.007792</td>
<td>2</td>
<td>1</td>
<td>0.666667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_piranha</td>
<td>19</td>
<td>[1]</td>
<td>0.002597</td>
<td>0.002597</td>
<td>0.000000</td>
<td>1</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_podre</td>
<td>20</td>
<td>[1]</td>
<td>0.002597</td>
<td>0.002597</td>
<td>0.000000</td>
<td>1</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_porra</td>
<td>21</td>
<td>[1]</td>
<td>0.106494</td>
<td>0.054545</td>
<td>0.025974</td>
<td>29</td>
<td>12</td>
<td>0.707317</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_pqp</td>
<td>22</td>
<td>[1]</td>
<td>0.090909</td>
<td>0.023377</td>
<td>0.012987</td>
<td>21</td>
<td>14</td>
<td>0.600000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_put</td>
<td>23</td>
<td>[1]</td>
<td>0.088312</td>
<td>0.064935</td>
<td>0.010390</td>
<td>25</td>
<td>9</td>
<td>0.735294</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_putinh</td>
<td>24</td>
<td>[1]</td>
<td>0.007792</td>
<td>0.007792</td>
<td>0.000000</td>
<td>3</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_ridicul</td>
<td>25</td>
<td>[1]</td>
<td>0.005195</td>
<td>0.005195</td>
<td>0.005195</td>
<td>2</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_sapatao</td>
<td>26</td>
<td>[1]</td>
<td>0.002597</td>
<td>0.002597</td>
<td>0.000000</td>
<td>1</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_tnc</td>
<td>27</td>
<td>[1]</td>
<td>0.015584</td>
<td>0.010390</td>
<td>0.002597</td>
<td>4</td>
<td>2</td>
<td>0.666667</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_vaca</td>
<td>28</td>
<td>[1]</td>
<td>0.002597</td>
<td>0.002597</td>
<td>0.002597</td>
<td>1</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_vagabund</td>
<td>29</td>
<td>[1]</td>
<td>0.005195</td>
<td>0.005195</td>
<td>0.000000</td>
<td>2</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_viado</td>
<td>30</td>
<td>[1]</td>
<td>0.005195</td>
<td>0.002597</td>
<td>0.000000</td>
<td>2</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_vsf</td>
<td>31</td>
<td>[0]</td>
<td>0.007792</td>
<td>0.005195</td>
<td>0.002597</td>
<td>2</td>
<td>1</td>
<td>0.666667</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_vtnc</td>
<td>32</td>
<td>[1]</td>
<td>0.005195</td>
<td>0.005195</td>
<td>0.000000</td>
<td>2</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_hf_toxic</td>
<td>33</td>
<td>[0, 1]</td>
<td>0.550649</td>
<td>0.254545</td>
<td>0.080519</td>
<td>195</td>
<td>17</td>
<td>0.919811</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>O transformer aumentou a cobertura de rotulação das instâncias de aproximadamente 54% para 86%, um aumento significativo de aproximadamente 32%. Porém, é importante perceber que o transformer atingiu um alto índice de conflito.</p>
<p>Analisando a nova Matriz de Conflito</p>
<div id="cell-33" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>matrix_graph(lfs, L_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/cell-16-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>O índice de acertabilidade do transformer como visto na tabela foi extremamente alto, contudo, mesmo assim apresentou erros, e liderou o conflito com as outras funções de rotulagem, principalmente com a palavra <em>cu</em> que é a mais citada das palavras escolhidas para compor as LF’s.</p>
</section>
<section id="labeling-functions-de-modelo-treinado-a-partir-de-dados-rotulados-por-as-lfs-das-palavras-e-do-transformer" class="level4">
<h4 class="anchored" data-anchor-id="labeling-functions-de-modelo-treinado-a-partir-de-dados-rotulados-por-as-lfs-das-palavras-e-do-transformer">Labeling Functions de Modelo Treinado a partir de dados rotulados por as LF’s das Palavras e do Transformer</h4>
<ul>
<li>A lógica que se segue é treinar um modelo de aprendizado de máquinas a partir das LF’s criadas anteriormente, e criar uma LF com ele.</li>
</ul>
<p>Definindo Função para treinamento de diferentes modelos</p>
<div id="cell-37" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Tuple</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier, ExtraTreesClassifier</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> XGBClassifier</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neural_network <span class="im">import</span> MLPClassifier</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> LinearSVC</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.naive_bayes <span class="im">import</span> MultinomialNB</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.calibration <span class="im">import</span> CalibratedClassifierCV</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> StratifiedKFold, cross_val_predict</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> f1_score, balanced_accuracy_score, accuracy_score, classification_report, matthews_corrcoef, confusion_matrix</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_and_evaluate_classification_models(X: pd.DataFrame, y: pd.Series) <span class="op">-&gt;</span> Tuple[pd.DataFrame, List]:</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Train multiple classification models and evaluate their performance.</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="co">        X (pd.DataFrame): The training data.</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="co">        y (pd.Series): The training labels.</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="co">        Tuple[pd.DataFrame, List]: A DataFrame with the performance metrics of each model and a list of classification reports.</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>    random_state <span class="op">=</span> <span class="dv">314</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define the models to be trained</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>    models <span class="op">=</span> []</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>    models.append((<span class="st">'Calibrated-LSVC'</span>, CalibratedClassifierCV(LinearSVC(random_state<span class="op">=</span><span class="dv">314</span>, class_weight<span class="op">=</span><span class="st">'balanced'</span>, dual<span class="op">=</span><span class="st">'auto'</span>))))</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>    models.append((<span class="st">'LR'</span>, LogisticRegression(random_state<span class="op">=</span><span class="dv">314</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>, class_weight<span class="op">=</span><span class="st">'balanced'</span>)))</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>    models.append((<span class="st">'RF'</span>, RandomForestClassifier(random_state<span class="op">=</span><span class="dv">314</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>, class_weight<span class="op">=</span><span class="st">'balanced'</span>)))</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>    models.append((<span class="st">'XGB'</span>, XGBClassifier(random_state<span class="op">=</span><span class="dv">314</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>, class_weight<span class="op">=</span><span class="st">'balanced'</span>, verbosity<span class="op">=</span><span class="dv">0</span>)))</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>    models.append((<span class="st">'MLP'</span>, MLPClassifier(random_state<span class="op">=</span><span class="dv">314</span>)))</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>    models.append((<span class="st">'NB'</span>, MultinomialNB()))</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>    models.append((<span class="st">'LSVC'</span>, LinearSVC(random_state<span class="op">=</span><span class="dv">314</span>, class_weight<span class="op">=</span><span class="st">'balanced'</span>)))</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>    models.append((<span class="st">'KNN'</span>, KNeighborsClassifier(n_jobs<span class="op">=-</span><span class="dv">1</span>)))</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>    models.append((<span class="st">'DT'</span>, DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">314</span>, class_weight<span class="op">=</span><span class="st">'balanced'</span>)))</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>    models.append((<span class="st">'ExtraTrees'</span>, ExtraTreesClassifier(random_state<span class="op">=</span><span class="dv">314</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>, class_weight<span class="op">=</span><span class="st">'balanced'</span>)))</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>    performance_results <span class="op">=</span> []</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>    classification_reports <span class="op">=</span> []</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>    cross_validation <span class="op">=</span> StratifiedKFold(n_splits<span class="op">=</span><span class="dv">10</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span>random_state)</span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> model_name, model <span class="kw">in</span> models:</span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>        start_time <span class="op">=</span> time.time()</span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>            predicted_labels <span class="op">=</span> cross_val_predict(estimator<span class="op">=</span>model, X<span class="op">=</span>X, y<span class="op">=</span>y, cv<span class="op">=</span>cross_validation,</span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>                                     method<span class="op">=</span><span class="st">"predict"</span>, n_jobs<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Error </span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span> </span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a>        f1 <span class="op">=</span> f1_score(y, predicted_labels, average<span class="op">=</span><span class="st">'micro'</span>)</span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a>        balanced_accuracy <span class="op">=</span> balanced_accuracy_score(y, predicted_labels)</span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a>        accuracy <span class="op">=</span> accuracy_score(y, predicted_labels)</span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a>        classification_report_str <span class="op">=</span> classification_report(y, predicted_labels)</span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a>        matthews_corr_coeff <span class="op">=</span> matthews_corrcoef(y, predicted_labels)</span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a>        confusion_mat <span class="op">=</span> confusion_matrix(y, predicted_labels)</span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a>        classification_reports.append([model_name, classification_report_str, confusion_mat])</span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a>        elapsed_time <span class="op">=</span> time.time() <span class="op">-</span> start_time</span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a>        performance_results.append([model_name, f1, balanced_accuracy, accuracy, matthews_corr_coeff, elapsed_time, confusion_mat, classification_report_str])</span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a>        <span class="co">'''</span></span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a><span class="co">        print(f'Model: {model_name} - F1: {f1:.4f} - Balanced Accuracy: {balanced_accuracy:.4f} - Accuracy: {accuracy:.4f} - Matthews Correlation Coefficient: {matthews_corr_coeff:.4f} - Elapsed time: {elapsed_time:.2f}s')</span></span>
<span id="cb25-72"><a href="#cb25-72" aria-hidden="true" tabindex="-1"></a><span class="co">        print(classification_report_str)</span></span>
<span id="cb25-73"><a href="#cb25-73" aria-hidden="true" tabindex="-1"></a><span class="co">        print(confusion_mat)</span></span>
<span id="cb25-74"><a href="#cb25-74" aria-hidden="true" tabindex="-1"></a><span class="co">        print('*' * 20, '</span><span class="ch">\n</span><span class="co">')</span></span>
<span id="cb25-75"><a href="#cb25-75" aria-hidden="true" tabindex="-1"></a><span class="co">        '''</span></span>
<span id="cb25-76"><a href="#cb25-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-77"><a href="#cb25-77" aria-hidden="true" tabindex="-1"></a>    results_df <span class="op">=</span> pd.DataFrame(performance_results, columns<span class="op">=</span>[<span class="st">'Model'</span>, <span class="st">'F1'</span>, <span class="st">'Balanced Accuracy'</span>, <span class="st">'Accuracy'</span>, <span class="st">'Matthews Correlation Coefficient'</span>, <span class="st">'Elapsed Time'</span>, <span class="st">'Confusion Matrix'</span>, <span class="st">'Classification Report'</span>])</span>
<span id="cb25-78"><a href="#cb25-78" aria-hidden="true" tabindex="-1"></a>    results_df[<span class="st">'Confusion Matrix'</span>] <span class="op">=</span> results_df[<span class="st">'Confusion Matrix'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">str</span>(x))</span>
<span id="cb25-79"><a href="#cb25-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-80"><a href="#cb25-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results_df, classification_reports</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Desempenho de diferentes modelos treinados a partir de Funções de Rotulagens que misturam a identificação de palavras com o Transformer</p>
<div id="cell-39" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>tfidf_vec_ssl <span class="op">=</span> TfidfVectorizer(ngram_range<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">2</span>), strip_accents<span class="op">=</span><span class="st">'unicode'</span>, lowercase<span class="op">=</span><span class="va">True</span>, max_features<span class="op">=</span><span class="dv">2000</span>, min_df<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>X_dev <span class="op">=</span> tfidf_vec_ssl.fit_transform(df_develop.text)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>X_dev <span class="op">=</span> X_dev.toarray()</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>y_dev <span class="op">=</span> df_develop.toxic.values</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Shape:'</span>, X_dev.shape, <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>df_results, creports <span class="op">=</span> train_and_evaluate_classification_models(X_dev, y_dev) </span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>df_results.sort_values(by<span class="op">=</span><span class="st">'Matthews Correlation Coefficient'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Shape: (385, 374) 
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Model</th>
<th data-quarto-table-cell-role="th">F1</th>
<th data-quarto-table-cell-role="th">Balanced Accuracy</th>
<th data-quarto-table-cell-role="th">Accuracy</th>
<th data-quarto-table-cell-role="th">Matthews Correlation Coefficient</th>
<th data-quarto-table-cell-role="th">Elapsed Time</th>
<th data-quarto-table-cell-role="th">Confusion Matrix</th>
<th data-quarto-table-cell-role="th">Classification Report</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>LSVC</td>
<td>0.644156</td>
<td>0.636821</td>
<td>0.644156</td>
<td>0.273009</td>
<td>0.169900</td>
<td>[[152 70]\n [ 67 96]]</td>
<td>precision recall f1-score ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>DT</td>
<td>0.631169</td>
<td>0.621483</td>
<td>0.631169</td>
<td>0.243378</td>
<td>0.252122</td>
<td>[[152 70]\n [ 72 91]]</td>
<td>precision recall f1-score ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>XGB</td>
<td>0.633766</td>
<td>0.615583</td>
<td>0.633766</td>
<td>0.237437</td>
<td>1.407682</td>
<td>[[163 59]\n [ 82 81]]</td>
<td>precision recall f1-score ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>RF</td>
<td>0.638961</td>
<td>0.606229</td>
<td>0.638961</td>
<td>0.236414</td>
<td>1.497457</td>
<td>[[182 40]\n [ 99 64]]</td>
<td>precision recall f1-score ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>LR</td>
<td>0.623377</td>
<td>0.613096</td>
<td>0.623377</td>
<td>0.226776</td>
<td>0.240224</td>
<td>[[151 71]\n [ 74 89]]</td>
<td>precision recall f1-score ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>NB</td>
<td>0.633766</td>
<td>0.600094</td>
<td>0.633766</td>
<td>0.224138</td>
<td>0.150079</td>
<td>[[182 40]\n [101 62]]</td>
<td>precision recall f1-score ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>ExtraTrees</td>
<td>0.618182</td>
<td>0.594733</td>
<td>0.618182</td>
<td>0.198714</td>
<td>1.247638</td>
<td>[[166 56]\n [ 91 72]]</td>
<td>precision recall f1-score ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>MLP</td>
<td>0.584416</td>
<td>0.567084</td>
<td>0.584416</td>
<td>0.136814</td>
<td>5.690514</td>
<td>[[151 71]\n [ 89 74]]</td>
<td>precision recall f1-score ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Calibrated-LSVC</td>
<td>0.584416</td>
<td>0.536920</td>
<td>0.584416</td>
<td>0.094075</td>
<td>1.764345</td>
<td>[[188 34]\n [126 37]]</td>
<td>precision recall f1-score ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>KNN</td>
<td>0.584416</td>
<td>0.529583</td>
<td>0.584416</td>
<td>0.084848</td>
<td>0.179999</td>
<td>[[197 25]\n [135 28]]</td>
<td>precision recall f1-score ...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Desempenho de diferentes modelos treinados a partir de apenas o Transformer</p>
<div id="cell-41" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Usando um modelo de transformador para gerar embeddings e depois usar um classificador em cima disso</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sentence_transformers <span class="im">import</span> SentenceTransformer</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> clear_output</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>PATH_LM <span class="op">=</span> <span class="st">'inctdd/told_br_binary_sm'</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> SentenceTransformer(PATH_LM)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>X_dev_transformer <span class="op">=</span> model.encode(df_develop.text.values, batch_size<span class="op">=</span><span class="dv">64</span>, show_progress_bar<span class="op">=</span><span class="va">True</span>, convert_to_tensor<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>df_results, creports <span class="op">=</span> train_and_evaluate_classification_models(X_dev_transformer, y_dev) </span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>clear_output(wait<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.encode(<span class="st">'teste'</span>).shape)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_dev_transformer.shape, <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>df_results.sort_values(by<span class="op">=</span><span class="st">'Matthews Correlation Coefficient'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(768,)
(385, 768) 
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Model</th>
<th data-quarto-table-cell-role="th">F1</th>
<th data-quarto-table-cell-role="th">Balanced Accuracy</th>
<th data-quarto-table-cell-role="th">Accuracy</th>
<th data-quarto-table-cell-role="th">Matthews Correlation Coefficient</th>
<th data-quarto-table-cell-role="th">Elapsed Time</th>
<th data-quarto-table-cell-role="th">Confusion Matrix</th>
<th data-quarto-table-cell-role="th">Classification Report</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>ExtraTrees</td>
<td>0.828571</td>
<td>0.823633</td>
<td>0.828571</td>
<td>0.648361</td>
<td>1.180001</td>
<td>[[190 32]\n [ 34 129]]</td>
<td>precision recall f1-score ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>RF</td>
<td>0.815584</td>
<td>0.809111</td>
<td>0.815584</td>
<td>0.620974</td>
<td>1.955261</td>
<td>[[189 33]\n [ 38 125]]</td>
<td>precision recall f1-score ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>XGB</td>
<td>0.807792</td>
<td>0.801539</td>
<td>0.807792</td>
<td>0.605189</td>
<td>10.979467</td>
<td>[[187 35]\n [ 39 124]]</td>
<td>precision recall f1-score ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>KNN</td>
<td>0.800000</td>
<td>0.796413</td>
<td>0.800000</td>
<td>0.591455</td>
<td>0.175097</td>
<td>[[182 40]\n [ 37 126]]</td>
<td>precision recall f1-score ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>MLP</td>
<td>0.750649</td>
<td>0.745468</td>
<td>0.750649</td>
<td>0.490164</td>
<td>5.801871</td>
<td>[[173 49]\n [ 47 116]]</td>
<td>precision recall f1-score ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>LR</td>
<td>0.748052</td>
<td>0.744031</td>
<td>0.748052</td>
<td>0.486251</td>
<td>0.609632</td>
<td>[[171 51]\n [ 46 117]]</td>
<td>precision recall f1-score ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>DT</td>
<td>0.740260</td>
<td>0.731567</td>
<td>0.740260</td>
<td>0.465651</td>
<td>1.544923</td>
<td>[[175 47]\n [ 53 110]]</td>
<td>precision recall f1-score ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>Calibrated-LSVC</td>
<td>0.709091</td>
<td>0.693127</td>
<td>0.709091</td>
<td>0.396131</td>
<td>9.157617</td>
<td>[[177 45]\n [ 67 96]]</td>
<td>precision recall f1-score ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>LSVC</td>
<td>0.688312</td>
<td>0.680001</td>
<td>0.688312</td>
<td>0.360610</td>
<td>3.773913</td>
<td>[[163 59]\n [ 61 102]]</td>
<td>precision recall f1-score ...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Os modelos treinados apenas pelo transformer obtiveram melhor desempenho do que os treinados com as funções de rotulagem que uniram a identificação de palavras mais o transformer. Contudo, por mais que tenha tido um desempenho inferior, para o bem do trabalho continuaremos usando as funções de rotulagem, para gerar um resultado com a partir de formas mais variadas de rotulação.</p>
<p>Criando Função de Rotulagem para melhor modelo obtido a partir do treinamento dos diversos modelos para o DataFrame de desenvolvimento</p>
<div id="cell-44" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>model_ssl <span class="op">=</span> CalibratedClassifierCV(LinearSVC(random_state<span class="op">=</span><span class="dv">314</span>, class_weight<span class="op">=</span><span class="st">'balanced'</span>, dual<span class="op">=</span><span class="st">'auto'</span>), cv<span class="op">=</span>StratifiedKFold(n_splits<span class="op">=</span><span class="dv">10</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">314</span>))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>model_ssl <span class="op">=</span> model_ssl.fit(X_dev, y_dev)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define uma função de pré-processamento que adiciona um rótulo previsto e uma pontuação a um exemplo dado usando um classificador empilhado</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="at">@preprocessor</span>(memoize<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_model_predict(x):</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Esta função é um pré-processador que usa um modelo LinearSVC pré-treinado para adicionar</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co">    uma etiqueta de previsão e um score aos dados de entrada.</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co">    - x: Um objeto contendo os dados de entrada, que deve ter um atributo 'text' contendo o texto a ser classificado.</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Retorna:</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co">    - O mesmo objeto de entrada 'x', mas com atributos adicionais 'pred_label' e 'score' adicionados com base nas previsões do modelo.</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Transformar o texto usando o vetorizador TF-IDF</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>    X_input <span class="op">=</span> tfidf_vec_ssl.transform([x.text])</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Obter as previsões do modelo</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>    pred_label <span class="op">=</span> model_ssl.predict(X_input)</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>    pred_score <span class="op">=</span> model_ssl.predict_proba(X_input).<span class="bu">max</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adicionar a etiqueta prevista ('pred_label') e a pontuação ('score') aos atributos do objeto 'x'</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>    x.pred_label <span class="op">=</span> <span class="bu">int</span>(pred_label[<span class="dv">0</span>])</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>    x.score <span class="op">=</span> <span class="bu">float</span>(pred_score[<span class="dv">0</span>])</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a><span class="at">@labeling_function</span>(pre<span class="op">=</span>[train_model_predict])</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> lf_train_model(x):</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a><span class="co">    Esta função de rotulagem atribui um rótulo baseado nas previsões do modelo LinearSVC.</span></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a><span class="co">    - x: Um objeto de entrada que deve ter atributos 'pred_label' e 'score' adicionados pelo pré-processador 'custom_model_predict'.</span></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a><span class="co">    Retorna:</span></span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a><span class="co">    - (1) se a pontuação for maior ou igual a 0.65 e o rótulo previsto for '1'.</span></span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a><span class="co">    - (0) se a pontuação for maior ou igual a 0.65 e o rótulo previsto for '0'.</span></span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a><span class="co">    - (-1) caso contrário.</span></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x.score <span class="op">&gt;=</span> <span class="fl">0.7</span>:</span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> x.pred_label <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> x.pred_label <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Remova qualquer função de rotulagem duplicada</span></span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a>lfs.append(lf_train_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-45" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>applier <span class="op">=</span> PandasLFApplier(lfs<span class="op">=</span>lfs)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>L_train <span class="op">=</span> applier.<span class="bu">apply</span>(df<span class="op">=</span>df_train)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>LFAnalysis(L_train, lfs).lf_summary()</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>L_dev <span class="op">=</span> applier.<span class="bu">apply</span>(df<span class="op">=</span>df_develop)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\n</span><span class="ss">Total Coverge: </span><span class="sc">{</span>LFAnalysis(L<span class="op">=</span>L_dev, lfs<span class="op">=</span>lfs)<span class="sc">.</span>label_coverage()<span class="sc">}</span><span class="ss">.'</span>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>LFAnalysis(L<span class="op">=</span>L_dev, lfs<span class="op">=</span>lfs).lf_summary(Y<span class="op">=</span>df_develop.toxic.values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 16030/16030 [02:59&lt;00:00, 89.25it/s] 
100%|██████████| 385/385 [00:04&lt;00:00, 94.22it/s] </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Total Coverge: 0.8805194805194805.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">j</th>
<th data-quarto-table-cell-role="th">Polarity</th>
<th data-quarto-table-cell-role="th">Coverage</th>
<th data-quarto-table-cell-role="th">Overlaps</th>
<th data-quarto-table-cell-role="th">Conflicts</th>
<th data-quarto-table-cell-role="th">Correct</th>
<th data-quarto-table-cell-role="th">Incorrect</th>
<th data-quarto-table-cell-role="th">Emp. Acc.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_e_amor</td>
<td>0</td>
<td>[0]</td>
<td>0.031169</td>
<td>0.031169</td>
<td>0.018182</td>
<td>9</td>
<td>3</td>
<td>0.750000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_boiola</td>
<td>1</td>
<td>[1]</td>
<td>0.002597</td>
<td>0.002597</td>
<td>0.000000</td>
<td>1</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_e_bom dia</td>
<td>2</td>
<td>[0]</td>
<td>0.005195</td>
<td>0.005195</td>
<td>0.002597</td>
<td>2</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_boa tarde</td>
<td>3</td>
<td>[0]</td>
<td>0.005195</td>
<td>0.005195</td>
<td>0.002597</td>
<td>1</td>
<td>1</td>
<td>0.500000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_buceta</td>
<td>4</td>
<td>[1]</td>
<td>0.010390</td>
<td>0.010390</td>
<td>0.000000</td>
<td>4</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_bunda</td>
<td>5</td>
<td>[1]</td>
<td>0.007792</td>
<td>0.007792</td>
<td>0.000000</td>
<td>3</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_e_carai</td>
<td>6</td>
<td>[0]</td>
<td>0.010390</td>
<td>0.002597</td>
<td>0.002597</td>
<td>3</td>
<td>1</td>
<td>0.750000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_caralho</td>
<td>7</td>
<td>[1]</td>
<td>0.103896</td>
<td>0.044156</td>
<td>0.010390</td>
<td>27</td>
<td>13</td>
<td>0.675000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_cu</td>
<td>8</td>
<td>[1]</td>
<td>0.083117</td>
<td>0.072727</td>
<td>0.028571</td>
<td>21</td>
<td>11</td>
<td>0.656250</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_feliz</td>
<td>9</td>
<td>[0]</td>
<td>0.018182</td>
<td>0.018182</td>
<td>0.005195</td>
<td>5</td>
<td>2</td>
<td>0.714286</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_f[uo]de</td>
<td>10</td>
<td>[1]</td>
<td>0.033766</td>
<td>0.028571</td>
<td>0.002597</td>
<td>10</td>
<td>3</td>
<td>0.769231</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_incrivel</td>
<td>11</td>
<td>[0]</td>
<td>0.005195</td>
<td>0.002597</td>
<td>0.002597</td>
<td>1</td>
<td>1</td>
<td>0.500000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_e_lind[oa]</td>
<td>12</td>
<td>[0]</td>
<td>0.018182</td>
<td>0.018182</td>
<td>0.007792</td>
<td>4</td>
<td>3</td>
<td>0.571429</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_maravilhos[oa]</td>
<td>13</td>
<td>[0]</td>
<td>0.005195</td>
<td>0.005195</td>
<td>0.000000</td>
<td>2</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_merd</td>
<td>14</td>
<td>[1]</td>
<td>0.023377</td>
<td>0.020779</td>
<td>0.005195</td>
<td>8</td>
<td>1</td>
<td>0.888889</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_mulherao</td>
<td>15</td>
<td>[0]</td>
<td>0.002597</td>
<td>0.002597</td>
<td>0.002597</td>
<td>1</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_pal</td>
<td>16</td>
<td>[1]</td>
<td>0.010390</td>
<td>0.010390</td>
<td>0.005195</td>
<td>3</td>
<td>1</td>
<td>0.750000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_pica</td>
<td>17</td>
<td>[1]</td>
<td>0.002597</td>
<td>0.000000</td>
<td>0.000000</td>
<td>1</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_pinto</td>
<td>18</td>
<td>[1]</td>
<td>0.007792</td>
<td>0.007792</td>
<td>0.007792</td>
<td>2</td>
<td>1</td>
<td>0.666667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_piranha</td>
<td>19</td>
<td>[1]</td>
<td>0.002597</td>
<td>0.002597</td>
<td>0.000000</td>
<td>1</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_podre</td>
<td>20</td>
<td>[1]</td>
<td>0.002597</td>
<td>0.002597</td>
<td>0.000000</td>
<td>1</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_porra</td>
<td>21</td>
<td>[1]</td>
<td>0.106494</td>
<td>0.054545</td>
<td>0.025974</td>
<td>29</td>
<td>12</td>
<td>0.707317</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_pqp</td>
<td>22</td>
<td>[1]</td>
<td>0.090909</td>
<td>0.025974</td>
<td>0.012987</td>
<td>21</td>
<td>14</td>
<td>0.600000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_put</td>
<td>23</td>
<td>[1]</td>
<td>0.088312</td>
<td>0.064935</td>
<td>0.010390</td>
<td>25</td>
<td>9</td>
<td>0.735294</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_putinh</td>
<td>24</td>
<td>[1]</td>
<td>0.007792</td>
<td>0.007792</td>
<td>0.000000</td>
<td>3</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_ridicul</td>
<td>25</td>
<td>[1]</td>
<td>0.005195</td>
<td>0.005195</td>
<td>0.005195</td>
<td>2</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_sapatao</td>
<td>26</td>
<td>[1]</td>
<td>0.002597</td>
<td>0.002597</td>
<td>0.000000</td>
<td>1</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_tnc</td>
<td>27</td>
<td>[1]</td>
<td>0.015584</td>
<td>0.010390</td>
<td>0.002597</td>
<td>4</td>
<td>2</td>
<td>0.666667</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_vaca</td>
<td>28</td>
<td>[1]</td>
<td>0.002597</td>
<td>0.002597</td>
<td>0.002597</td>
<td>1</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_o_vagabund</td>
<td>29</td>
<td>[1]</td>
<td>0.005195</td>
<td>0.005195</td>
<td>0.000000</td>
<td>2</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_viado</td>
<td>30</td>
<td>[1]</td>
<td>0.005195</td>
<td>0.002597</td>
<td>0.000000</td>
<td>2</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_r_e_vsf</td>
<td>31</td>
<td>[0]</td>
<td>0.007792</td>
<td>0.005195</td>
<td>0.002597</td>
<td>2</td>
<td>1</td>
<td>0.666667</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_r_o_vtnc</td>
<td>32</td>
<td>[1]</td>
<td>0.005195</td>
<td>0.005195</td>
<td>0.000000</td>
<td>2</td>
<td>0</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lf_hf_toxic</td>
<td>33</td>
<td>[0, 1]</td>
<td>0.550649</td>
<td>0.324675</td>
<td>0.080519</td>
<td>195</td>
<td>17</td>
<td>0.919811</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lf_train_model</td>
<td>34</td>
<td>[0, 1]</td>
<td>0.122078</td>
<td>0.106494</td>
<td>0.015584</td>
<td>47</td>
<td>0</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>O modelo treinado aumentou a cobertura de rotulagem de aproximadamente 86% para 88%. Não é um aumentou substancial, porém se mostrou útil.</p>
<pre><code>Recapitulando conceitos a partir de modelo de rotulagem final (Palavras + Transformer + Modelo de Aprendizado de Máquinas) obtido:</code></pre>
<ol type="1">
<li><p>Cobertura das Funções de Rotulagem:</p>
<ul>
<li>As funções de rotulagem podem cobrir diferentes partes do conjunto de dados, ou seja, algumas funções podem rotular mais exemplos que outras. Isso é o que significa “cobertura”.</li>
</ul></li>
<li><p>Sobreposição e Conflito:</p>
<ul>
<li>As funções de rotulagem podem se sobrepor, o que significa que mais de uma função pode rotular o mesmo exemplo. Elas também podem entrar em conflito, o que significa que diferentes funções podem atribuir rótulos diferentes ao mesmo exemplo.</li>
</ul></li>
<li><p>Precisões:</p>
<ul>
<li>Cada função de rotulagem pode ter uma precisão diferente, ou seja, algumas podem ser mais precisas na atribuição de rótulos corretos do que outras.</li>
</ul></li>
<li><p>Histograma:</p>
<ul>
<li>Para entender melhor a cobertura total das funções de rotulagem, podemos visualizar um histograma que mostra quantos rótulos foram atribuídos pelos LFs aos pontos de dados no conjunto de treinamento.</li>
<li>Esse histograma ajuda a dar uma ideia de quantos exemplos foram rotulados por nenhuma, uma ou várias funções de rotulagem, o que é essencial para avaliar a qualidade e a cobertura do processo de rotulagem automática.</li>
</ul></li>
</ol>
<div id="cell-48" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_label_distribution(label_matrix: np.ndarray) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Plota a distribuição do número de rótulos por exemplo no conjunto de dados.</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co">        label_matrix (np.ndarray): Um array 2D numpy onde cada linha representa um exemplo e cada coluna representa um rótulo.</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="co">                                   O valor é -1 se o rótulo não for atribuído ao exemplo, e um valor diferente caso contrário.</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co">        None</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcular o número de rótulos para cada exemplo</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    num_labels_per_example <span class="op">=</span> (label_matrix <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span>).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plotar um histograma do número de rótulos por exemplo</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plt.hist(num_labels_per_example, density=True, bins=range(label_matrix.shape[1])) # Para o caso de querer deixar o eixo x com o número total de rótulos</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>    plt.hist(num_labels_per_example, density<span class="op">=</span><span class="va">True</span>, bins<span class="op">=</span><span class="bu">range</span>(<span class="dv">8</span>)) <span class="co"># Delimitar manualmente o número de rótulos no eixo x</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Definir o rótulo do eixo x</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Número de rótulos"</span>)</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Definir o rótulo do eixo y</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Fração do conjunto de dados"</span>)</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mostrar o gráfico</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotar a frequência de rótulos no conjunto de treinamento</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>plot_label_distribution(L_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/cell-22-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>O gráfico mostra que a maioria das instâncias foram rotuladas por entre uma e duas funções de rotulagem. Isso se deve ao Transformer aliado ao modelo de AM que possuíram altos Overlaps, cobrindo assim as funções de rotulagens das palavras.</p>
</section>
<section id="comparando-treinamento-modelo-de-am-para-dataframe-com-rótulos-reais-e-rótulos-de-funções-de-rotulagem" class="level4">
<h4 class="anchored" data-anchor-id="comparando-treinamento-modelo-de-am-para-dataframe-com-rótulos-reais-e-rótulos-de-funções-de-rotulagem">Comparando treinamento modelo de AM para DataFrame com Rótulos Reais, e Rótulos de Funções de Rotulagem</h4>
<pre><code>OBS: RETIRANDO ABSTENÇÕES DO DF COM RÓTULOS ORIGINAIS E GERADOS</code></pre>
<p>Atribuindo Rótulos obtidos a partir de Funções das Rotulagem no DataFrame para Treino Final</p>
<div id="cell-52" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> snorkel.labeling.model <span class="im">import</span> LabelModel</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando cópia do DF de treino</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>df_train_final_total <span class="op">=</span> df_train_final.copy()</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Treinar um modelo de rótulo para combinar os rótulos das LFs</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>label_model <span class="op">=</span> LabelModel(cardinality<span class="op">=</span><span class="dv">2</span>, verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>label_model.fit(L_train<span class="op">=</span>L_train, n_epochs<span class="op">=</span><span class="dv">500</span>, log_freq<span class="op">=</span><span class="dv">100</span>, seed<span class="op">=</span><span class="dv">314</span>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Obter os rótulos finais</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>df_train_final_total[<span class="st">'toxic_LF'</span>] <span class="op">=</span> label_model.predict(L<span class="op">=</span>L_train)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Excluindo rótulos inconclusivos (-1)</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>df_train_final_total <span class="op">=</span> df_train_final_total[df_train_final_total[<span class="st">'toxic_LF'</span>] <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Analisando acurácia dos rótulos das LFs que foram rotuladas com sucesso (sem o valor de -1)</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\n</span><span class="ss">F1      : </span><span class="sc">{</span>f1_score(df_train_final_total[<span class="st">'toxic'</span>], df_train_final_total[<span class="st">'toxic_LF'</span>], average<span class="op">=</span><span class="st">'micro'</span>)<span class="sc">:.4f}</span><span class="ss">'</span>)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Accuracy: </span><span class="sc">{</span>accuracy_score(df_train_final_total[<span class="st">'toxic'</span>], df_train_final_total[<span class="st">'toxic_LF'</span>])<span class="sc">:.4f}</span><span class="ch">\n</span><span class="ss">'</span>)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>df_train_final_total.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 500/500 [00:01&lt;00:00, 361.28epoch/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
F1      : 0.7826
Accuracy: 0.7826
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">text</th>
<th data-quarto-table-cell-role="th">toxic</th>
<th data-quarto-table-cell-role="th">toxic_LF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2422</td>
<td>rt user ai so porque tirou ele cai https co kr...</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15371</td>
<td>pior duvida</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7312</td>
<td>user giovana vai se fuder mano fica pffff</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1524</td>
<td>harry caralho nao que tu bom mesmo https co nt...</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13716</td>
<td>rt user eu ia falar contigo mas tu tava com ca...</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Como pode ser visto, os rótulos gerados a partir das LFs previstos com sucesso (diferentes de -1) obtiveram uma acurácia de <strong>78.26%</strong> comparando diretamente com rotulos reais.</p>
<div id="cell-54" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustar o vetor TF-IDF no conjunto de treinamento</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>tfidf_vec_ssl.fit(df_train_final_total.text)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformar o conjunto de treinamento e de teste com o vetor TF-IDF ajustado</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> tfidf_vec_ssl.transform(df_train_final_total.text)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> X_train.toarray()</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> tfidf_vec_ssl.transform(df_test.text)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> X_test.toarray()</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Converter os rótulos para arrays</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> df_train_final_total.toxic.values</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>y_train_LF <span class="op">=</span> df_train_final_total.toxic_LF.values</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> df_test.toxic.values</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Shape Train:'</span>, X_train.shape)</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Shape Test:'</span>, X_test.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Shape Train: (14105, 2000)
Shape Test: (385, 2000)</code></pre>
</div>
</div>
<p>Apenas para fins de verificação de qual modelo treinado (o com rotulagens reais e o com rotulagens geradas) do DataFrame de treino melhor irá predizer dados novos, que serão os ainda intocados do DataFrame de teste. Para isso será utilizado o modelo de treinamento já usado anteriormente (LSVC). Ele foi escolhido visando diminuir o custo computacional do teste, dado as limitações da máquina utilizada.</p>
<div id="cell-56" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Treinando modelo com rótulos reais</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>model_ssl_train <span class="op">=</span> CalibratedClassifierCV(LinearSVC(random_state<span class="op">=</span><span class="dv">314</span>, class_weight<span class="op">=</span><span class="st">'balanced'</span>, dual<span class="op">=</span><span class="st">'auto'</span>), cv<span class="op">=</span>StratifiedKFold(n_splits<span class="op">=</span><span class="dv">10</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">314</span>))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>model_ssl_train <span class="op">=</span> model_ssl_train.fit(X_train, y_train)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Treinando modelo com rótulos gerados</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>model_ssl_train_LF <span class="op">=</span> CalibratedClassifierCV(LinearSVC(random_state<span class="op">=</span><span class="dv">314</span>, class_weight<span class="op">=</span><span class="st">'balanced'</span>, dual<span class="op">=</span><span class="st">'auto'</span>), cv<span class="op">=</span>StratifiedKFold(n_splits<span class="op">=</span><span class="dv">10</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">314</span>))</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>model_ssl_train_LF <span class="op">=</span> model_ssl_train_LF.fit(X_train, y_train_LF)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-57" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>f1_orig <span class="op">=</span> f1_score(y_test, model_ssl_train.predict(X_test), average<span class="op">=</span><span class="st">'micro'</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>f1_gen <span class="op">=</span> f1_score(y_test, model_ssl_train_LF.predict(X_test), average<span class="op">=</span><span class="st">'micro'</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>mcc_orig <span class="op">=</span> matthews_corrcoef(y_test, model_ssl_train.predict(X_test))</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>mcc_gen <span class="op">=</span> matthews_corrcoef(y_test, model_ssl_train_LF.predict(X_test))</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>acc_orig <span class="op">=</span> accuracy_score(y_test, model_ssl_train.predict(X_test))</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>acc_gen <span class="op">=</span> accuracy_score(y_test, model_ssl_train_LF.predict(X_test))</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>bac_orig <span class="op">=</span> balanced_accuracy_score(y_test, model_ssl_train.predict(X_test))</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>bac_gen <span class="op">=</span> balanced_accuracy_score(y_test, model_ssl_train_LF.predict(X_test))</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(data <span class="op">=</span> {</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Métrica'</span>: [<span class="st">'F1S'</span>, <span class="st">'MCC'</span>, <span class="st">'ACC'</span>, <span class="st">'BAC'</span>],</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Rótulos Originais'</span>: [f1_orig, mcc_orig, acc_orig, bac_orig],</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Rótulos Gerados'</span>: [f1_gen, mcc_gen, acc_gen, bac_gen]</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Métrica</th>
<th data-quarto-table-cell-role="th">Rótulos Originais</th>
<th data-quarto-table-cell-role="th">Rótulos Gerados</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>F1S</td>
<td>0.750649</td>
<td>0.766234</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>MCC</td>
<td>0.483009</td>
<td>0.522897</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>ACC</td>
<td>0.750649</td>
<td>0.766234</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>BAC</td>
<td>0.732424</td>
<td>0.762242</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Por incrível que pareça, o dataframe com <strong>rótulos gerados</strong> desempenhou melhor que o com <strong>rótulos originais</strong> na predição do DataFrame de teste. É um resultado curioso, e um pouco assustador. Porém, é importante notar que as linhas com textos com os resultados inconclusivos (-1) para os <strong>rótulos gerados</strong>, foram retirados tanto deles como dos <strong>rótulos originais</strong>. Se faz necessário verificar se caso eles estivessem no treinamento do dataframe dos <strong>rótulos originais</strong>, ele acabaria gerando predições melhores que a dos <strong>rótulos gerados</strong> por causa da maior cobertura de casos.</p>
</section>
<section id="comparando-treinamento-modelo-de-am-para-dataframe-com-rótulos-reais-e-rótulos-de-funções-de-rotulagem-1" class="level4">
<h4 class="anchored" data-anchor-id="comparando-treinamento-modelo-de-am-para-dataframe-com-rótulos-reais-e-rótulos-de-funções-de-rotulagem-1">Comparando treinamento modelo de AM para DataFrame com Rótulos Reais, e Rótulos de Funções de Rotulagem</h4>
<pre><code>OBS: RETIRANDO ABSTENÇÕES APENAS DO DF COM GERADOS</code></pre>
<div id="cell-60" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> snorkel.labeling.model <span class="im">import</span> LabelModel</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando cópia do DF de treino</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>df_train_final_com_abstencao <span class="op">=</span> df_train_final.copy()</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando DF de predição</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>df_train_final_sem_abstencao <span class="op">=</span> pd.DataFrame()</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>df_train_final_sem_abstencao[<span class="st">'text'</span>] <span class="op">=</span> df_train_final_com_abstencao[<span class="st">'text'</span>]</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Treinar um modelo de rótulo para combinar os rótulos das LFs</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>label_model <span class="op">=</span> LabelModel(cardinality<span class="op">=</span><span class="dv">2</span>, verbose<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>label_model.fit(L_train<span class="op">=</span>L_train, n_epochs<span class="op">=</span><span class="dv">500</span>, log_freq<span class="op">=</span><span class="dv">100</span>, seed<span class="op">=</span><span class="dv">314</span>)</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Obter os rótulos finais</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>df_train_final_sem_abstencao[<span class="st">'toxic'</span>] <span class="op">=</span> label_model.predict(L<span class="op">=</span>L_train)</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Excluindo rótulos inconclusivos (-1)</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>df_train_final_sem_abstencao <span class="op">=</span> df_train_final_sem_abstencao[df_train_final_sem_abstencao[<span class="st">'toxic'</span>] <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Observando diferença de quantidade de dados dos DFs com </span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a><span class="co"># rótulos originais e gerados</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">''</span>)</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_train_final_com_abstencao.info(), <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_train_final_sem_abstencao.info())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100%|██████████| 500/500 [00:00&lt;00:00, 598.64epoch/s]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
&lt;class 'pandas.core.frame.DataFrame'&gt;
Index: 16030 entries, 2422 to 235
Data columns (total 2 columns):
 #   Column  Non-Null Count  Dtype 
---  ------  --------------  ----- 
 0   text    16030 non-null  object
 1   toxic   16030 non-null  int64 
dtypes: int64(1), object(1)
memory usage: 375.7+ KB
None 

&lt;class 'pandas.core.frame.DataFrame'&gt;
Index: 14105 entries, 2422 to 12172
Data columns (total 2 columns):
 #   Column  Non-Null Count  Dtype 
---  ------  --------------  ----- 
 0   text    14105 non-null  object
 1   toxic   14105 non-null  int32 
dtypes: int32(1), object(1)
memory usage: 275.5+ KB
None</code></pre>
</div>
</div>
<div id="cell-61" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustar o vetor TF-IDF no conjunto de treinamento</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>tfidf_vec_ssl.fit(df_train_final_com_abstencao.text)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>tfidf_vec_ssl.fit(df_train_final_sem_abstencao.text)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformar o conjunto de treinamento e de teste com o vetor TF-IDF ajustado</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>X_train_com_abstencao <span class="op">=</span> tfidf_vec_ssl.transform(df_train_final_com_abstencao.text)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>X_train_com_abstencao <span class="op">=</span> X_train_com_abstencao.toarray()</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>X_train_sem_abstencao <span class="op">=</span> tfidf_vec_ssl.transform(df_train_final_sem_abstencao.text)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>X_train_sem_abstencao <span class="op">=</span> X_train_sem_abstencao.toarray()</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> tfidf_vec_ssl.transform(df_test.text)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> X_test.toarray()</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Converter os rótulos para arrays</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>y_train_com_abstencao <span class="op">=</span> df_train_final_com_abstencao.toxic.values</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>y_train_sem_abstencao <span class="op">=</span> df_train_final_sem_abstencao.toxic.values</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> df_test.toxic.values</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Shape de Treino com Abstenções:'</span>, X_train_com_abstencao.shape)</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Shape de Treino sem Abstenções:'</span>, X_train_sem_abstencao.shape)</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Shape de Teste:'</span>, X_test.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Shape de Treino com Abstenções: (16030, 2000)
Shape de Treino sem Abstenções: (14105, 2000)
Shape de Teste: (385, 2000)</code></pre>
</div>
</div>
<div id="cell-62" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Treinando modelo com rótulos reais</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>model_ssl_train_com_abstencao <span class="op">=</span> CalibratedClassifierCV(LinearSVC(random_state<span class="op">=</span><span class="dv">314</span>, class_weight<span class="op">=</span><span class="st">'balanced'</span>, dual<span class="op">=</span><span class="st">'auto'</span>), cv<span class="op">=</span>StratifiedKFold(n_splits<span class="op">=</span><span class="dv">10</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">314</span>))</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>model_ssl_train_com_abstencao <span class="op">=</span> model_ssl_train_com_abstencao.fit(X_train_com_abstencao, y_train_com_abstencao)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Treinando modelo com rótulos gerados</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>model_ssl_train_sem_abstencao <span class="op">=</span> CalibratedClassifierCV(LinearSVC(random_state<span class="op">=</span><span class="dv">314</span>, class_weight<span class="op">=</span><span class="st">'balanced'</span>, dual<span class="op">=</span><span class="st">'auto'</span>), cv<span class="op">=</span>StratifiedKFold(n_splits<span class="op">=</span><span class="dv">10</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">314</span>))</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>model_ssl_train_sem_abstencao <span class="op">=</span> model_ssl_train_sem_abstencao.fit(X_train_sem_abstencao, y_train_sem_abstencao)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-63" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>f1_orig <span class="op">=</span> f1_score(y_test, model_ssl_train_com_abstencao.predict(X_test), average<span class="op">=</span><span class="st">'micro'</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>f1_gen <span class="op">=</span> f1_score(y_test, model_ssl_train_sem_abstencao.predict(X_test), average<span class="op">=</span><span class="st">'micro'</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>mcc_orig <span class="op">=</span> matthews_corrcoef(y_test, model_ssl_train_com_abstencao.predict(X_test))</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>mcc_gen <span class="op">=</span> matthews_corrcoef(y_test, model_ssl_train_sem_abstencao.predict(X_test))</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>acc_orig <span class="op">=</span> accuracy_score(y_test, model_ssl_train_com_abstencao.predict(X_test))</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>acc_gen <span class="op">=</span> accuracy_score(y_test, model_ssl_train_sem_abstencao.predict(X_test))</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>bac_orig <span class="op">=</span> balanced_accuracy_score(y_test, model_ssl_train_com_abstencao.predict(X_test))</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>bac_gen <span class="op">=</span> balanced_accuracy_score(y_test, model_ssl_train_sem_abstencao.predict(X_test))</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(data <span class="op">=</span> {</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Métrica'</span>: [<span class="st">'F1S'</span>, <span class="st">'MCC'</span>, <span class="st">'ACC'</span>, <span class="st">'BAC'</span>],</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Rótulos Originais'</span>: [f1_orig, mcc_orig, acc_orig, bac_orig],</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Rótulos Gerados'</span>: [f1_gen, mcc_gen, acc_gen, bac_gen]</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>    })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Métrica</th>
<th data-quarto-table-cell-role="th">Rótulos Originais</th>
<th data-quarto-table-cell-role="th">Rótulos Gerados</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>F1S</td>
<td>0.745455</td>
<td>0.766234</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>MCC</td>
<td>0.471954</td>
<td>0.522897</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>ACC</td>
<td>0.745455</td>
<td>0.766234</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>BAC</td>
<td>0.727104</td>
<td>0.762242</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Novamente os rótulos originais obtiveram uma acurácia menor que a dos rótulos gerados. É curioso, mas essas são algumas possíveis explicações analisadas.</p>
<ul>
<li><p><strong>DataFrame de Teste</strong>: O DataFrame de teste foi um recorte do dataset não usado durante todo o aprendizado de máquinas, porém, pode ser que esse recorte em particular seja melhor representado pelo modelo treinado com o DF com rótulos gerados, do que pelo modelo treinado com o DF com rótulos originais.</p></li>
<li><p><strong>Exclusão de Dados Ambiguos</strong>: Ao extrair os comentários que as LFs não conseguiram rotular, retira-se com isso comentários que podem ser contraditórios para a máquina. Isso pode ser constatado ao notar que o DF com rótulos originais que tiveram as abstenções das LFs excluídas geraram um modelo melhor do que o DF que não excluiu. Aliado a outros fatores, isso pode ter agravado o motivo que levou a uma menor acurácia.</p></li>
<li><p><strong>Influência do Transformer</strong>: Por mais que o transformer tenha apenas integrado parte das LF’s que realizaram a rotulagem, ele se trata de um modelo para o mesmo dataset do trabalho, logo, a influência dele junto de outros fatores pode ter sido preponderante para que o DataFrame com rótulos gerados tenha gerado predições melhores que o DataFrame com rótulos originais.</p></li>
<li><p><strong>Modelo de Aprendizado de Máquinas</strong>: A primeira é que como o modelo treinado foi o mesmo usado para os dois, sem ajustes de acordo com cada um dos DF’s, talvez ele por acaso seja mais ajustado ao DF dos rótulos gerados, contudo, caso fosse ajustado um modelo para cada um dos dois DF’s, visando elevar de forma particular para cada suas respectivas acurácias, os rótulos originais obtivessem resultados melhores que os rótulos gerados.</p></li>
<li><p><strong>Particularidades do Dataset</strong>: O dataset usado visando extrair comentários tóxicos dos usuários do twitter por si só é rotulado de forma subjetiva. Isto porque comentários que usam palavras de baixo calão não necessariamente são tóxicos, e a interpretação pode variar bastante dependendo de quem o analisa. Logo, pode ser que os rótulos atribuídos pelas LB’s demonstrem menos subjetividade, e por mais que os dados usados para testar a acurácia possua rótulos originais não usados no treinamento, de alguma forma essa diminuição da subjetividade tenha ajudado no treinamento do modelo de AM.</p></li>
<li><p><strong>Tamanho do Dataset</strong>: O tamanho do dataset também pode ter sido um fator preponderante. Isto por que talvez a quantidade de dados usados no treinamento tenham limitado mais a capacidade de predição do DF com rótulos originais, do que a do DF com rótulos gerados.</p></li>
</ul>
<p>De qualquer forma, para este caso, com este Dataset, os rótulos gerados para o Dataset se mostrou mais eficaz que os rótulos originais no treinamento de modelos de aprendizado de máquinas.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>